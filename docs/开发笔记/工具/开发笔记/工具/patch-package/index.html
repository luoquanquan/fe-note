<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("http://note.niubishanshan.top").hostname,root:"/",scheme:"Gemini",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.json",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="昨天着实被同事给上了一课. 事情是这样的, 项目中之前打包用到了老式打包工具 (相对编译时间很长那种), 于是就要把项目升级成编译速度更快的 esbuild. 特么的就我负责的模块出了问题…  背景在我们的项目从 gulp 编译切换到 esbuild 的过程中, 其他同学负责的代码都是使用的非常常规的三方库. 而我的代码中用到了 crypto. 在 gulp 中可以使用 browserify 插"><meta property="og:type" content="article"><meta property="og:title" content="patch-package"><meta property="og:url" content="http://note.niubishanshan.top/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/patch-package/index.html"><meta property="og:site_name" content="圈圈的笔记"><meta property="og:description" content="昨天着实被同事给上了一课. 事情是这样的, 项目中之前打包用到了老式打包工具 (相对编译时间很长那种), 于是就要把项目升级成编译速度更快的 esbuild. 特么的就我负责的模块出了问题…  背景在我们的项目从 gulp 编译切换到 esbuild 的过程中, 其他同学负责的代码都是使用的非常常规的三方库. 而我的代码中用到了 crypto. 在 gulp 中可以使用 browserify 插"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20220929145340.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20220929150349.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20220929153204.png"><meta property="article:published_time" content="2022-09-29T06:19:40.000Z"><meta property="article:modified_time" content="2024-06-27T15:04:43.292Z"><meta property="article:author" content="圈圈的圈"><meta property="article:tag" content="开发笔记"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://handle-note-img.niubishanshan.top/20220929145340.png"><link rel="canonical" href="http://note.niubishanshan.top/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/patch-package/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>patch-package | 圈圈的笔记</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a target="_blank" rel="noopener" href="https://github.com/luoquanquan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">圈圈的笔记</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">路漫漫其修远兮, 吾将上下而求索</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://note.niubishanshan.top/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/patch-package/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="圈圈的圈"><meta itemprop="description" content="技术学习, 读书笔记, 生活感悟 ~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="圈圈的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> patch-package</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-09-29 14:19:40" itemprop="dateCreated datePublished" datetime="2022-09-29T14:19:40+08:00">2022-09-29</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-27 23:04:43" itemprop="dateModified" datetime="2024-06-27T23:04:43+08:00">2024-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">开发笔记</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>昨天着实被同事给上了一课. 事情是这样的, 项目中之前打包用到了老式打包工具 (相对编译时间很长那种), 于是就要把项目升级成编译速度更快的 esbuild. 特么的就我负责的模块出了问题…</p></blockquote><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在我们的项目从 <code>gulp</code> 编译切换到 <code>esbuild</code> 的过程中, 其他同学负责的代码都是使用的非常常规的三方库. 而我的代码中用到了 <code>crypto</code>. 在 <code>gulp</code> 中可以使用 <code>browserify</code> 插件. 直接给把 <code>node</code> 模块给 shim 进来了. 但是 <code>esbuild</code> 负责处理 node 模块的 <code>@esbuild-plugins/node-modules-polyfill</code> 木有这个逻辑…</p><span id="more"></span><h2 id="定位问题"><a href="#定位问题" class="headerlink" title="定位问题"></a>定位问题</h2><p>首先, 发现 <code>crypto</code> 缺失之后肯定是看病用药. 先观察 <code>@esbuild-plugins/node-modules-polyfill</code> 的源码 <a target="_blank" rel="noopener" href="https://github.com/remorses/esbuild-plugins/tree/master/node-modules-polyfill/src">github</a>, 说实话看到这种两个 years 没有动过的只有 203 star 的开源项目心里实在是打鼓. 顺手一个 star 当然是少不了的.</p><p><img src="https://handle-note-img.niubishanshan.top/20220929145340.png" alt="20220929145340"></p><p>下一步打开 <a target="_blank" rel="noopener" href="https://github.com/remorses/esbuild-plugins/blob/master/node-modules-polyfill/src/polyfills.ts">polyfills.ts</a> 源码发现原来这就是 <code>rollup-plugin-node-polyfills</code> 的套壳呀. 那不就好办了. 直接把 crypto 模块也放出来就完事儿. 而且官方也曾经规划过要干这个事儿的 ~</p><p><img src="https://handle-note-img.niubishanshan.top/20220929150349.png" alt="20220929150349"></p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>面对这种已经已经给出答案的题目, 我最喜欢了:</p><ol><li>clone 这个项目.</li><li>本地硬改代码.</li><li>引用包改成本地</li><li>完事</li></ol><p>然后, 我的同事淡淡地说: 要不打个 patch 试试呢?</p><p><img src="https://handle-note-img.niubishanshan.top/20220929153204.png" alt="20220929153204"></p><p>patch 又是什么鬼?</p><p>网上搜了一把才发现, 打开了新世界.</p><h3 id="方案一-用-patch-package-给-npm-包打补丁"><a href="#方案一-用-patch-package-给-npm-包打补丁" class="headerlink" title="方案一: 用 patch-package 给 npm 包打补丁"></a>方案一: 用 patch-package 给 npm 包打补丁</h3><h4 id="第一步-生成补丁文件"><a href="#第一步-生成补丁文件" class="headerlink" title="第一步, 生成补丁文件"></a>第一步, 生成补丁文件</h4><ul><li>首先, 安装 patch-package <code>npm i patch-package -D</code></li><li>修改 node_modules 里边的包内容并验证</li><li>执行 <code>npx patch-package @esbuild-plugins/node-modules-polyfill</code> 生成补丁文件</li></ul><p>执行上述步骤之后就会生成 <code>patches/@esbuild-plugins+node-modules-polyfill+0.1.4.patch</code> 这个文件. 文件内容为:</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/node_modules/@esbuild-plugins/node-modules-polyfill/dist/polyfills.js b/node_modules/@esbuild-plugins/node-modules-polyfill/dist/polyfills.js</span></span><br><span class="line"><span class="comment">index 4f4f953..6f6263e 100644</span></span><br><span class="line"><span class="comment">--- a/node_modules/@esbuild-plugins/node-modules-polyfill/dist/polyfills.js</span></span><br><span class="line"><span class="comment">+++ b/node_modules/@esbuild-plugins/node-modules-polyfill/dist/polyfills.js</span></span><br><span class="line"><span class="meta">@@ -43,18 +43,18 @@</span> function builtinsPolyfills() &#123;</span><br><span class="line">     libs.set(&#x27;repl&#x27;, EMPTY_PATH);</span><br><span class="line">     libs.set(&#x27;tls&#x27;, EMPTY_PATH);</span><br><span class="line">     libs.set(&#x27;fs&#x27;, EMPTY_PATH);</span><br><span class="line"><span class="deletion">-    libs.set(&#x27;crypto&#x27;, EMPTY_PATH);</span></span><br><span class="line"><span class="addition">+    // libs.set(&#x27;crypto&#x27;, EMPTY_PATH);</span></span><br><span class="line">     // libs.set(</span><br><span class="line">     //     &#x27;fs&#x27;,</span><br><span class="line">     //     require.resolve(&#x27;rollup-plugin-node-polyfills/polyfills/browserify-fs&#x27;),</span><br><span class="line">     // )</span><br><span class="line">     // TODO enable crypto and fs https://github.com/ionic-team/rollup-plugin-node-polyfills/issues/20</span><br><span class="line"><span class="deletion">-    // libs.set(</span></span><br><span class="line"><span class="deletion">-    //     &#x27;crypto&#x27;,</span></span><br><span class="line"><span class="deletion">-    //     require.resolve(</span></span><br><span class="line"><span class="deletion">-    //         &#x27;rollup-plugin-node-polyfills/polyfills/crypto-browserify&#x27;,</span></span><br><span class="line"><span class="deletion">-    //     ),</span></span><br><span class="line"><span class="deletion">-    // )</span></span><br><span class="line"><span class="addition">+    libs.set(</span></span><br><span class="line"><span class="addition">+        &#x27;crypto&#x27;,</span></span><br><span class="line"><span class="addition">+        require.resolve(</span></span><br><span class="line"><span class="addition">+            &#x27;rollup-plugin-node-polyfills/polyfills/crypto-browserify&#x27;,</span></span><br><span class="line"><span class="addition">+        ),</span></span><br><span class="line"><span class="addition">+    )</span></span><br><span class="line">     return libs;</span><br><span class="line"> &#125;</span><br><span class="line"> exports.builtinsPolyfills = builtinsPolyfills;</span><br></pre></td></tr></table></figure><p>不难看出, <code>patch-package</code> 就是将你修改后的代码和修改前的代码做了一次 diff. 并依据此 diff 文件来确定你本次的修改. 然后就是想办法应用到我们的真实项目中了.</p><h4 id="应用补丁文件"><a href="#应用补丁文件" class="headerlink" title="应用补丁文件"></a>应用补丁文件</h4><p>在 package.json 中添加 <code>npm-script</code> 即可在后续每次安装依赖后都调用 patch-package 实现补丁的替换</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 依赖安装完成后执行 patch-package</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;postinstall&quot;</span><span class="punctuation">:</span> <span class="string">&quot;patch-package&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><p>移除项目中的 <code>node_modules</code> 目录, 重新 <code>npm i</code>, 查看 <code>node_modules/@esbuild-plugins/node-modules-polyfill/dist/polyfills.js</code> 文件就能发现文件内容如下, patch 成功 ~</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="comment">// Taken from https://github.com/ionic-team/rollup-plugin-node-polyfills/blob/master/src/modules.ts</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="built_in">exports</span>, <span class="string">&quot;__esModule&quot;</span>, &#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">builtinsPolyfills</span> = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMPTY_PATH</span> = <span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;rollup-plugin-node-polyfills/polyfills/empty.js&#x27;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">builtinsPolyfills</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> libs = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="comment">// ==========  其他代码  =====================================</span></span><br><span class="line">    <span class="comment">// ==========  ......  =====================================</span></span><br><span class="line">    <span class="comment">// ==========  其他代码  =====================================</span></span><br><span class="line">    libs.<span class="title function_">set</span>(<span class="string">&#x27;fs&#x27;</span>, <span class="variable constant_">EMPTY_PATH</span>);</span><br><span class="line">    <span class="comment">// libs.set(&#x27;crypto&#x27;, EMPTY_PATH);</span></span><br><span class="line">    <span class="comment">// libs.set(</span></span><br><span class="line">    <span class="comment">//     &#x27;fs&#x27;,</span></span><br><span class="line">    <span class="comment">//     require.resolve(&#x27;rollup-plugin-node-polyfills/polyfills/browserify-fs&#x27;),</span></span><br><span class="line">    <span class="comment">// )</span></span><br><span class="line">    <span class="comment">// TODO enable crypto and fs https://github.com/ionic-team/rollup-plugin-node-polyfills/issues/20</span></span><br><span class="line">    libs.<span class="title function_">set</span>(</span><br><span class="line">        <span class="string">&#x27;crypto&#x27;</span>,</span><br><span class="line">        <span class="built_in">require</span>.<span class="title function_">resolve</span>(</span><br><span class="line">            <span class="string">&#x27;rollup-plugin-node-polyfills/polyfills/crypto-browserify&#x27;</span>,</span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> libs;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">builtinsPolyfills</span> = builtinsPolyfills;</span><br></pre></td></tr></table></figure><p>PS: 测试项目我上传到 <a href="">github</a> 了…</p><h3 id="方案二-三方包魔改"><a href="#方案二-三方包魔改" class="headerlink" title="方案二: 三方包魔改"></a>方案二: 三方包魔改</h3><h4 id="修改一个文件"><a href="#修改一个文件" class="headerlink" title="修改一个文件"></a>修改一个文件</h4><p>复制问题库的一个文件放到本地, 还是监听 <code>postinstall</code> 每次 <code>install</code> 完成后替换 node_modules 里的文件为本地文件</p><h4 id="维护整个库"><a href="#维护整个库" class="headerlink" title="维护整个库"></a>维护整个库</h4><p>克隆这个项目下来, 修改代码后存放在自己的项目库中自己维护整个项目. 具体实现有两种方案</p><h5 id="项目中维护"><a href="#项目中维护" class="headerlink" title="项目中维护"></a>项目中维护</h5><p>就是把自己修改的第三方包作为页面代码的一个目录, 跟随项目代码迭代</p><h5 id="发布私包"><a href="#发布私包" class="headerlink" title="发布私包"></a>发布私包</h5><p>修改三方包的 bug 后改个名发布到 npm 或者 内部的 npm 镜像上</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>综合比较, 使用 patch 方案最为靠谱, 原因主要有:</p><ol><li>锁定了版本号, 如果三方包升级后 patch 脚本会报错. 用户有感知</li><li>每次安装后会修改 node_modules 里的代码. 下个人想要打新的补丁直接继续修改自己本地的 node_modules 即会基于之前的补丁修改. 理论上不会有冲突</li><li>占用空间最小, diff 文件和 git diff 一致. 修改了哪里一目了然.</li></ol><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6962554654643191815">手把手教你使用patch-package给npm包打补丁</a></li><li><a target="_blank" rel="noopener" href="https://github.com/ds300/patch-package">https://github.com/ds300/patch-package</a></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" rel="tag"># 开发笔记</a></div><div class="post-nav"><div class="post-nav-item"><a href="/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/github%20hosts%20%E5%8F%98%E5%BF%AB/" rel="prev" title="github hosts 变快"><i class="fa fa-chevron-left"></i> github hosts 变快</a></div><div class="post-nav-item"> <a href="/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87-Offer/%E6%95%B0%E7%BB%84%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87%20Offer/%E6%95%B0%E7%BB%84%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2/53%20-%20I.%20%E5%9C%A8%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E6%9F%A5%E6%89%BE%E6%95%B0%E5%AD%97%20I/" rel="next" title="53 - I. 在排序数组中查找数字 I">53 - I. 在排序数组中查找数字 I<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>
  window.addEventListener('tabs:register', function() {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-text">背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98"><span class="nav-text">定位问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80-%E7%94%A8-patch-package-%E7%BB%99-npm-%E5%8C%85%E6%89%93%E8%A1%A5%E4%B8%81"><span class="nav-text">方案一: 用 patch-package 给 npm 包打补丁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5-%E7%94%9F%E6%88%90%E8%A1%A5%E4%B8%81%E6%96%87%E4%BB%B6"><span class="nav-text">第一步, 生成补丁文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E8%A1%A5%E4%B8%81%E6%96%87%E4%BB%B6"><span class="nav-text">应用补丁文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81"><span class="nav-text">验证</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C-%E4%B8%89%E6%96%B9%E5%8C%85%E9%AD%94%E6%94%B9"><span class="nav-text">方案二: 三方包魔改</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6"><span class="nav-text">修改一个文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%B4%E6%8A%A4%E6%95%B4%E4%B8%AA%E5%BA%93"><span class="nav-text">维护整个库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%BB%B4%E6%8A%A4"><span class="nav-text">项目中维护</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E7%A7%81%E5%8C%85"><span class="nav-text">发布私包</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="圈圈的圈" src="/images/avatar.png"><p class="site-author-name" itemprop="name">圈圈的圈</p><div class="site-description" itemprop="description">技术学习, 读书笔记, 生活感悟 ~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">142</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://juejin.im/user/5837c2bd61ff4b006ca8d1b2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5837c2bd61ff4b006ca8d1b2" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://github.com/luoquanquan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoquanquan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:luo_quanquan@163.com" title="E-Mail → mailto:luo_quanquan@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17034706号-1</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">圈圈的圈</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/js/theme-next-canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>
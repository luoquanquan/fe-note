<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("http://note.niubishanshan.top").hostname,root:"/",scheme:"Gemini",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.json",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="本节视频 https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Vt411X7JF&#x2F;?p&#x3D;5 区块链是一个去中心化的账本, 比特币采用了基于交易的账本模式(transaction-based ledger). 然而, 系统中并无显示记录账户包含比特币数, 实际上其需要通过交易记录进行推算. 在比特币系统中, 全节点需要维护一个名为 UTXO(Unspent Transaction O"><meta property="og:type" content="article"><meta property="og:title" content="5. 比特币系统的实现"><meta property="og:url" content="http://note.niubishanshan.top/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8/5.%20%E6%AF%94%E7%89%B9%E5%B8%81%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/index.html"><meta property="og:site_name" content="圈圈的笔记"><meta property="og:description" content="本节视频 https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Vt411X7JF&#x2F;?p&#x3D;5 区块链是一个去中心化的账本, 比特币采用了基于交易的账本模式(transaction-based ledger). 然而, 系统中并无显示记录账户包含比特币数, 实际上其需要通过交易记录进行推算. 在比特币系统中, 全节点需要维护一个名为 UTXO(Unspent Transaction O"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20230102194529.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20230102200409.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20230102214913.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20230102220553.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20230102221607.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20230102221921.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20230102221932.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240623105925.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240623110316.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240623111821.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240623120557.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240623122457.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240623122912.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240623123412.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240623130932.png"><meta property="article:published_time" content="2023-11-02T11:37:53.000Z"><meta property="article:modified_time" content="2024-06-27T15:04:43.279Z"><meta property="article:author" content="圈圈的圈"><meta property="article:tag" content="笔记"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://handle-note-img.niubishanshan.top/20230102194529.png"><link rel="canonical" href="http://note.niubishanshan.top/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8/5.%20%E6%AF%94%E7%89%B9%E5%B8%81%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>5. 比特币系统的实现 | 圈圈的笔记</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a target="_blank" rel="noopener" href="https://github.com/luoquanquan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">圈圈的笔记</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">路漫漫其修远兮, 吾将上下而求索</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://note.niubishanshan.top/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8/5.%20%E6%AF%94%E7%89%B9%E5%B8%81%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="圈圈的圈"><meta itemprop="description" content="技术学习, 读书笔记, 生活感悟 ~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="圈圈的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 5. 比特币系统的实现</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-11-02 19:37:53" itemprop="dateCreated datePublished" datetime="2023-11-02T19:37:53+08:00">2023-11-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-27 23:04:43" itemprop="dateModified" datetime="2024-06-27T23:04:43+08:00">2024-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">区块链技术与应用</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>本节视频 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vt411X7JF/?p=5">https://www.bilibili.com/video/BV1Vt411X7JF/?p=5</a></p><p>区块链是一个去中心化的账本, 比特币采用了基于交易的账本模式(transaction-based ledger). 然而, 系统中并无显示记录账户包含比特币数, 实际上其需要通过交易记录进行推算. 在比特币系统中, 全节点需要维护一个名为 <strong>UTXO</strong>(Unspent Transaction Output尚未被花掉的交易输出)的数据结构. 用于记录比特币系统中尚未倍花出去的比特币的情况.</p><p>UTXO 的运行过程如下示例</p><ul><li>A 有 8 个 BTC, 他给 B 转了 5 个, 给 C 转了 3 个. 此时 B 的 5 个和 C 的 3 个 BTC 都在 UTXO 中</li><li>B 将自己的 5 个 BTC 转给了别人, 此时他的 BTC 会从 UTXO 中移除</li><li>由于 C 始终没有花出自己的 BTC 所以他的 3 个 BTC一直存在于 UTXO 中</li></ul><span id="more"></span><p><img src="https://handle-note-img.niubishanshan.top/20230102194529.png" alt="20230102194529"></p><p>UTXO 中每个元素 (也就是还没有花的BTC) 要给出输出这个元素的交易的哈希值以及该元素是交易中的第几个输出. 同理, 通过这两个信息便可以定位到 UTXO 中的元素, 方便用户转账交易中到 UTXO 中查询所转 BTC 的合法性.</p><h2 id="为什么要维护-UTXO"><a href="#为什么要维护-UTXO" class="headerlink" title="为什么要维护 UTXO"></a>为什么要维护 UTXO</h2><p>全节点要参与区块的构建, 构建区块过程中需要校验交易的合法性. 所以全节点都在内存中(快速校验)维护了 UTXO 集合. 判断一笔交易是否合法, 直接查一下交易想要花费的 BTC 是否在 UTXO 集合中, 如果想要花掉的 BTC 在 UTXO 集合中根本不存在则说明两种情况:</p><ul><li>这个 BTC 根本不存在</li><li>这个 BTC 已经被花费过</li></ul><p>上述两种情况种的任何一种情况, 交易都为非法交易. 基于上述逻辑可以高效的检测出 double spending(双花攻击).</p><h2 id="UTXO-工作流程"><a href="#UTXO-工作流程" class="headerlink" title="UTXO 工作流程"></a>UTXO 工作流程</h2><blockquote><p>每笔交易都会消耗 UTXO 集合中的输出, 同时也会产生新的输出.</p></blockquote><p>例如, 上例中 A -&gt; B: 5 BTC, B -&gt; D: 5 BTC. 虽然 B 的 BTC 已经从 UTXO 移除了, 但是 D 的 BTC 加入到了集合中.</p><p><img src="https://handle-note-img.niubishanshan.top/20230102200409.png" alt="20230102200409"></p><p>如果有人收到了一笔 BTC 转账, 但是一直不花那么这笔转账的 BTC 会一直存在于 UTXO 中.</p><h2 id="交易费"><a href="#交易费" class="headerlink" title="交易费"></a>交易费</h2><p>每个交易都会有输入也会有输出, 往往交易的输出之和要小于输入之和. 这里的部分差额就作为获取记账权的节点帮你记账所要收取的手续费. 这笔手续费作为矿工住了铸币交易之外的收益. 目前交易费的收入远远小于出块奖励. 但是根据比特币系统的规则, 以后的出块奖励会越来越少, 所以交易费可能会占越来越大的比重.</p><h2 id="出块奖励"><a href="#出块奖励" class="headerlink" title="出块奖励"></a>出块奖励</h2><p>比特币系统中, 每产生 21 万个区块 BTC 出块奖励就会减半. 大约为每 4 年出块奖励就会减半.</p><p>比特币是基于交易的模式, 与之对应还有一种基于账户的模式(以太坊). 基于账户的模式要求, 系统中显式的记录账户的余额. 也就是说可以直接查询当前账户有多少钱.</p><p>比特币隐私保护性好, 但是每次转账时要说明币的来源 (UTXO) 来防止双花. 而基于账户的模式则天然规避了这个问题. 转账就是一个(或多个)账户的余额减小, 另外一个(或多个)账户余额增加的过程.</p><h2 id="BTC-具体区块信息"><a href="#BTC-具体区块信息" class="headerlink" title="BTC 具体区块信息"></a>BTC 具体区块信息</h2><p>区块浏览器<a target="_blank" rel="noopener" href="https://www.blockchain.com/explorer/blocks/btc/529709">地址</a></p><p>对应的中文版本<a target="_blank" rel="noopener" href="https://blockchair.com/zh/bitcoin/block/529709">地址</a></p><p><img src="https://handle-note-img.niubishanshan.top/20230102214913.png" alt="20230102214913"></p><p><img src="https://handle-note-img.niubishanshan.top/20230102220553.png" alt="20230102220553"></p><h2 id="什么是挖矿"><a href="#什么是挖矿" class="headerlink" title="什么是挖矿"></a>什么是挖矿</h2><p>如上图所示, 区块哈希和前一区块的哈希都是一串 0 开头的. 挖矿的本身就是尝试各种 nonce, 使得产生的区块哈希值小于目标值, 这个目标值表示成 16 进制的话也是前边一串 0.</p><p>根据 BTC 源码, nonce 是一个 32 位的无符号整形数据. 在挖矿过程中矿机通过不断地调整 nonce 进行. nonce 的取值最多为 2 ** 32 个. 但是不一定把这些可能性的 case 都尝试一遍就一定能找到合适的结果. 那咋办呢?</p><h2 id="调整-Merkle-Tree-root-hash"><a href="#调整-Merkle-Tree-root-hash" class="headerlink" title="调整 Merkle Tree root hash"></a>调整 Merkle Tree root hash</h2><p><img src="https://handle-note-img.niubishanshan.top/20230102221607.png" alt="20230102221607"></p><p>如上图, 如果仅仅通过调整 nonce 不够用时. 可以通过调整 Merkle Tree 的根哈希实现. 但是原则上讲打包的交易和顺序确定了, 跟哈希值就确定了. 看上去就无法修改了.</p><p>其实, 旷工除了打包普通的交易之外. 每次发布区块的区块奖励实际上是构造了一笔铸币交易(coinBase), 而铸币交易也要打包到当前区块中. 下图是铸币交易的描述</p><p><img src="https://handle-note-img.niubishanshan.top/20230102221921.png" alt="20230102221921"></p><p><img src="https://handle-note-img.niubishanshan.top/20230102221932.png" alt="20230102221932"></p><p>铸币交易中有个 coinBase 域, 可以写入任何内容. 那么矿工就可以通过修改写入 coinBase 域的内容实现 Merkle Tree root hash 的调整. 从而计算出满足挖矿需求的 hash</p><p><img src="https://handle-note-img.niubishanshan.top/20240623105925.png" alt="20240623105925"></p><p>如图所示, 修改 tx 的 coinBase 域, 交易的哈希值发生变化. 该变化会沿着默克尔树往上转移, 并最终影响到 Merkle Root 的根哈希. 在实际的挖矿中包含两层循环. 外层循环调整 coinBase 域 (可以规定只将其中前x个字节作为另一个nonce) 算出 block header 中根哈希值后, 内层循环再调整nonce.</p><h2 id="普通转账交易"><a href="#普通转账交易" class="headerlink" title="普通转账交易"></a>普通转账交易</h2><p><img src="https://handle-note-img.niubishanshan.top/20240623110316.png" alt="20240623110316"></p><p>交易合法性的验证: 将前一笔交易的输出脚本和当前交易的输入脚本拼接之后执行. 如果可以正常执行且没有报错说明交易合法 ~</p><h2 id="挖矿过程的概率分析"><a href="#挖矿过程的概率分析" class="headerlink" title="挖矿过程的概率分析"></a>挖矿过程的概率分析</h2><p>挖矿的本质是不断尝试各种 nonce 来求解 puzzle, 每次尝试都是一次伯努利实验. 类似于抛硬币, 正反面朝上的概率分别为 p 和 1 - p. 一次伯努利实验中成功的概率极小, 失败的概率极大. 挖矿的过程就是进行多次伯努利实验且每次随机. 这些伯努利实验构成了一系列独立的伯努利实验. 然而由于伯努利实验本身没有记忆性. 这一次的成功和失败并不会影响下一次实验的结果. 就像买彩票, 你很多次不中奖并不影响你下次中奖的概率.</p><p><img src="https://handle-note-img.niubishanshan.top/20240623111821.png" alt="20240623111821"></p><blockquote><p>比特币系统的平均出块时间为 10min, 由比特币系统设计. 通过调整挖矿难度实现出块时间在 10min 左右. 比方说当前比特币系统中矿工较多, 全网算力比较大, 那么就调高难度. 如果当前比特币系统中矿工较少, 算力变小则调低挖矿难度. 比特币系统调整挖矿难度的时机是每出块 2016 个时. 系统查看目前的 2016 个块的出块时间(理论上是 20160 分钟, 也就是两周). 如果总时常小于两周, 说明当前算力大于预期需要调高难度. 反之调低.</p></blockquote><p>由于指数分布的无记忆性, 对于比特币系统来说. 就算当前已经过去了 10min 还是没有矿工挖到区块, 那么所有矿工仍然需要平均等待 10min. 就像北京小汽车摇号, 你本次没有摇到下次并不代表你马上就要摇到. 同理将来你需要挖多长时间和你已经挖了多长时间没有关系(progress free).</p><p>progress free: 比如一个矿工的算力是另外一个矿工的 10 倍, 由于 progress free 的特性, 算力强的矿工尝试 nonce 的数度是后者的十倍也就是说他获得记账权的概率是后者的 10 倍, 如果不是 progress free 的话, 算力强的矿工过去尝试了更多的 nonce 那么以后他获得记账权的概率就会增大. 造成不成比例的记账权优势.</p><h2 id="比特币总量计算"><a href="#比特币总量计算" class="headerlink" title="比特币总量计算"></a>比特币总量计算</h2><blockquote><p>每 21 万个比特币, 出块奖励就会减半. 比特币的稀缺性是人为造成的</p></blockquote><p><img src="https://handle-note-img.niubishanshan.top/20240623120557.png" alt="20240623120557"></p><p>根据上图中的规则, 最终可以发行的比特币只有 2100万枚. 挖矿求解 puzzle 的本身是没有意义的, 但是挖矿的过程对于维护比特币系统的安全性是至关重要的.</p><p>只要大部分算力是掌握在诚实的节点手上的话, 便能确保比特币系统的稳定性.</p><p>随着出块奖励的降低, 手续费在促进矿工挖矿的占比将越来越大 ~</p><h2 id="比特币的安全性分析"><a href="#比特币的安全性分析" class="headerlink" title="比特币的安全性分析"></a>比特币的安全性分析</h2><blockquote><p>多数算力掌握在诚实的节点中, 能否保证不良交易记录不被写入到区块链?</p><p>实际上算力低的节点并不是完全不能获得记账权, 他们获取记账权的概率相对于算力高的节点更低而已. 因此, 即使是算力较低的恶意节点也有概率能够获取到记账权.</p></blockquote><h3 id="能否“偷币”"><a href="#能否“偷币”" class="headerlink" title="能否“偷币”"></a>能否“偷币”</h3><p>恶意节点能不能把别人的币转给自己?</p><p>不能, 因为恶意节点无法获取到他人的私钥, 故无法伪造出别人的签名. 如果恶意节点强行在区块中写入该交易. 大多数诚实的节点验证该区块不合法后并不会认可该区块. 并继续沿着该区块的父级区块继续挖矿. 随着时间的推移拥有大算力的诚实节点将会沿着老的父级区块形成新的“最长合法链”. 恶意节点发布的区块将成为孤块而被抛弃. 对于攻击者来说, 既没有得到比特币也没有得到区块奖励. 白白浪费电 ~</p><p><img src="https://handle-note-img.niubishanshan.top/20240623122457.png" alt="20240623122457"></p><h3 id="能否把自己花过的钱在花一遍"><a href="#能否把自己花过的钱在花一遍" class="headerlink" title="能否把自己花过的钱在花一遍"></a>能否把自己花过的钱在花一遍</h3><blockquote><p>我能否把转给你的 BTC 再转给自己?</p></blockquote><p><img src="https://handle-note-img.niubishanshan.top/20240623122912.png" alt="20240623122912"></p><p>如图, 在上方区块中 M 把 BTC 转给了 A, 但是在下方的区块中 M 又把转给 A 的 BTC 转给了自己的小号. 同时由于 M 掌握了记账权, 实现了转给 A 的交易的回滚. 然而, 如果攻击者想要回滚的区块不是当前区块链的最后一个区块, 攻击的难度会更大 ~</p><p><img src="https://handle-note-img.niubishanshan.top/20240623123412.png" alt="20240623123412"></p><p>如图, 如果 M 想要回滚给 A 的转账, 不仅需要修改 <code>M - A</code> 这个区块, 还需要回滚后续的几个区块来构造出新的“最长合法链”, 否者多数诚实节点不会认可其发布的 <code>M - M</code> 节点.</p><p>因此, 一种简单的防范恶意节点的方式便是多等几个区块的确认, 比特币系统中, 如果交易经过了 6 个区块的确认(1 小时)就会被认为是不可篡改的. 也就是说, 刚刚写入区块链的内容是有可能被修改的, 经过一段时间之后被篡改的概率就会大幅下降(因为改动需要的算力成本更高了).</p><h3 id="能否故意不打包合法交易"><a href="#能否故意不打包合法交易" class="headerlink" title="能否故意不打包合法交易"></a>能否故意不打包合法交易</h3><p>可以, 但是后续的区块可能会包含该交易. 实际运行过程中, 可能存在某个时间段交易数量变多一个区块放不下这么多交易的场景. 在这种场景下就会存在当前发布的交易不会被立刻打包的情况, 这个时候后续的节点会打包该交易 ~</p><h3 id="selfish-mining"><a href="#selfish-mining" class="headerlink" title="selfish mining"></a>selfish mining</h3><p>提前挖到区块但是不发布, 继续挖下去. 等到要攻击的交易等了 6 次确认之后再发布, 试图回滚原来的记录. 这种情况需要恶意节点掌握了系统中半数以上(实际不止半数以上)的算力才行. 否则肯定竞争不过多数的诚实节点.</p><p><img src="https://handle-note-img.niubishanshan.top/20240623130932.png" alt="20240623130932"></p><p>如图, 某个节点挖到了一个区块之后先不广播, 而是基于自己挖出来的区块继续挖. 直到别人挖出来第一个区块时候我同时发布两个区块. 这样你还是最长的链. 然而别的矿工挖了半天白玩儿了. 然而, 想要搞这样的套路需要你掌握了足够优势的算力. 要不, 你一个人挑战全网, 有可能你还没有挖出第二个区块人家别人挖出来了. 造成你“隐藏链”不如人家公布出来的链长. 你自作聪明了 ~</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"># 笔记</a></div><div class="post-nav"><div class="post-nav-item"><a href="/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/html/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/html5/%E5%B8%B8%E8%A7%81%E7%9A%84%20html%20%E5%9D%91/" rel="prev" title="常见的 html 坑"><i class="fa fa-chevron-left"></i> 常见的 html 坑</a></div><div class="post-nav-item"> <a href="/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8/6.%20%E6%AF%94%E7%89%B9%E5%B8%81%E7%BD%91%E7%BB%9C/" rel="next" title="6. 比特币网络">6. 比特币网络<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>
  window.addEventListener('tabs:register', function() {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%BB%B4%E6%8A%A4-UTXO"><span class="nav-text">为什么要维护 UTXO</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UTXO-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-text">UTXO 工作流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%A4%E6%98%93%E8%B4%B9"><span class="nav-text">交易费</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BA%E5%9D%97%E5%A5%96%E5%8A%B1"><span class="nav-text">出块奖励</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BTC-%E5%85%B7%E4%BD%93%E5%8C%BA%E5%9D%97%E4%BF%A1%E6%81%AF"><span class="nav-text">BTC 具体区块信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%8C%96%E7%9F%BF"><span class="nav-text">什么是挖矿</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E6%95%B4-Merkle-Tree-root-hash"><span class="nav-text">调整 Merkle Tree root hash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E8%BD%AC%E8%B4%A6%E4%BA%A4%E6%98%93"><span class="nav-text">普通转账交易</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%96%E7%9F%BF%E8%BF%87%E7%A8%8B%E7%9A%84%E6%A6%82%E7%8E%87%E5%88%86%E6%9E%90"><span class="nav-text">挖矿过程的概率分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AF%94%E7%89%B9%E5%B8%81%E6%80%BB%E9%87%8F%E8%AE%A1%E7%AE%97"><span class="nav-text">比特币总量计算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E5%88%86%E6%9E%90"><span class="nav-text">比特币的安全性分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%BD%E5%90%A6%E2%80%9C%E5%81%B7%E5%B8%81%E2%80%9D"><span class="nav-text">能否“偷币”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%BD%E5%90%A6%E6%8A%8A%E8%87%AA%E5%B7%B1%E8%8A%B1%E8%BF%87%E7%9A%84%E9%92%B1%E5%9C%A8%E8%8A%B1%E4%B8%80%E9%81%8D"><span class="nav-text">能否把自己花过的钱在花一遍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%BD%E5%90%A6%E6%95%85%E6%84%8F%E4%B8%8D%E6%89%93%E5%8C%85%E5%90%88%E6%B3%95%E4%BA%A4%E6%98%93"><span class="nav-text">能否故意不打包合法交易</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#selfish-mining"><span class="nav-text">selfish mining</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="圈圈的圈" src="/images/avatar.png"><p class="site-author-name" itemprop="name">圈圈的圈</p><div class="site-description" itemprop="description">技术学习, 读书笔记, 生活感悟 ~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">142</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://juejin.im/user/5837c2bd61ff4b006ca8d1b2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5837c2bd61ff4b006ca8d1b2" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://github.com/luoquanquan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoquanquan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:luo_quanquan@163.com" title="E-Mail → mailto:luo_quanquan@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17034706号-1</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">圈圈的圈</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/js/theme-next-canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>
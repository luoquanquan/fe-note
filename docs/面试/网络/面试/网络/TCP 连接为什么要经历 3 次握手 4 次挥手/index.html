<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("http://note.niubishanshan.top").hostname,root:"/",scheme:"Gemini",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.json",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="三次握手三次握手, 其实就是说创建一个客户端到服务器TCP链接需要发送的三个包. 主要作用就是确认通信双方的接收能力和发送能力是否正常, 并指定初始化序列号为后续的传输做准备. 三次握手过程 第一次握手, 客户端给服务端发一个 SYN 报文, 并指明客户端初始状态的序列号 ISN(c), 此时的客户端处于 SYN_SENT 状态. 服务端接收到此次握手后能确认客户端的发送和服务端的接收功能没有问题"><meta property="og:type" content="article"><meta property="og:title" content="TCP 连接为什么要经历 3 次握手 4 次挥手"><meta property="og:url" content="http://note.niubishanshan.top/%E9%9D%A2%E8%AF%95/%E7%BD%91%E7%BB%9C/%E9%9D%A2%E8%AF%95/%E7%BD%91%E7%BB%9C/TCP%20%E8%BF%9E%E6%8E%A5%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%BB%8F%E5%8E%86%203%20%E6%AC%A1%E6%8F%A1%E6%89%8B%204%20%E6%AC%A1%E6%8C%A5%E6%89%8B/index.html"><meta property="og:site_name" content="圈圈的笔记"><meta property="og:description" content="三次握手三次握手, 其实就是说创建一个客户端到服务器TCP链接需要发送的三个包. 主要作用就是确认通信双方的接收能力和发送能力是否正常, 并指定初始化序列号为后续的传输做准备. 三次握手过程 第一次握手, 客户端给服务端发一个 SYN 报文, 并指明客户端初始状态的序列号 ISN(c), 此时的客户端处于 SYN_SENT 状态. 服务端接收到此次握手后能确认客户端的发送和服务端的接收功能没有问题"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/2021-12-10-10-30-39.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/2021-12-10-10-33-01.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/2021-12-10-10-34-17.png"><meta property="article:published_time" content="2021-12-10T02:28:35.000Z"><meta property="article:modified_time" content="2024-06-27T15:04:43.301Z"><meta property="article:author" content="圈圈的圈"><meta property="article:tag" content="网络"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://handle-note-img.niubishanshan.top/2021-12-10-10-30-39.png"><link rel="canonical" href="http://note.niubishanshan.top/%E9%9D%A2%E8%AF%95/%E7%BD%91%E7%BB%9C/%E9%9D%A2%E8%AF%95/%E7%BD%91%E7%BB%9C/TCP%20%E8%BF%9E%E6%8E%A5%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%BB%8F%E5%8E%86%203%20%E6%AC%A1%E6%8F%A1%E6%89%8B%204%20%E6%AC%A1%E6%8C%A5%E6%89%8B/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>TCP 连接为什么要经历 3 次握手 4 次挥手 | 圈圈的笔记</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a target="_blank" rel="noopener" href="https://github.com/luoquanquan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">圈圈的笔记</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">路漫漫其修远兮, 吾将上下而求索</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://note.niubishanshan.top/%E9%9D%A2%E8%AF%95/%E7%BD%91%E7%BB%9C/%E9%9D%A2%E8%AF%95/%E7%BD%91%E7%BB%9C/TCP%20%E8%BF%9E%E6%8E%A5%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%BB%8F%E5%8E%86%203%20%E6%AC%A1%E6%8F%A1%E6%89%8B%204%20%E6%AC%A1%E6%8C%A5%E6%89%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="圈圈的圈"><meta itemprop="description" content="技术学习, 读书笔记, 生活感悟 ~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="圈圈的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> TCP 连接为什么要经历 3 次握手 4 次挥手</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-12-10 10:28:35" itemprop="dateCreated datePublished" datetime="2021-12-10T10:28:35+08:00">2021-12-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-27 23:04:43" itemprop="dateModified" datetime="2024-06-27T23:04:43+08:00">2024-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">面试</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E9%9D%A2%E8%AF%95/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h2><p>三次握手, 其实就是说创建一个客户端到服务器TCP链接需要发送的三个包. 主要作用就是确认通信双方的接收能力和发送能力是否正常, 并指定初始化序列号为后续的传输做准备.</p><h3 id="三次握手过程"><a href="#三次握手过程" class="headerlink" title="三次握手过程"></a>三次握手过程</h3><ol><li>第一次握手, 客户端给服务端发一个 SYN 报文, 并指明客户端初始状态的序列号 ISN(c), 此时的客户端处于 SYN_SENT 状态. 服务端接收到此次握手后能确认客户端的发送和服务端的接收功能没有问题.</li><li>第二次握手, 服务端收到客户端的 SYN 报文之后, 会以自己的 SYN 报文作为回答. 同时为了告诉客户端自己收到了他的第一次握手信息. 将客户端的 ISN 值 + 1 作为 ack 返回给客户端, 此时服务端处于 SYN_RCVD 状态, 此时客户端可以明确, 客户端 &#x2F; 服务单, 发送 &#x2F; 接收功能都正常, 但是此时服务端不知道客户端接收信息能力如何.</li><li>第三次握手, 客户端收到 SYN 报文之后, 会发送一个 ACK 报文, 值为服务端的 ISN + 1, 此时客户端处于 ESTABLISHED 状态. 当服务器收到 ACK 报文之后也会进入 ESTABLISHED 状态. 至此服务端确定了客户端发送, 接收信息功能正常, 链接建立成功.</li></ol><span id="more"></span><p><img src="https://handle-note-img.niubishanshan.top/2021-12-10-10-30-39.png" alt="TCP 三次握手"></p><h3 id="三次握手作用"><a href="#三次握手作用" class="headerlink" title="三次握手作用"></a>三次握手作用</h3><p>通过三次握手, 客户端 &#x2F; 服务端双方都能确认对方信息传输能力正常可以进行通信</p><h3 id="为什么不能两次握手"><a href="#为什么不能两次握手" class="headerlink" title="为什么不能两次握手"></a>为什么不能两次握手</h3><p>根据上述的作用分析, 如果仅有两次握手, 客户端能知道自己发送的信息服务端能收到, 服务端回复的消息自己也能收到. 但是服务端只能知道客户端发送的信息自己可以正常接收, 但是不能确定自己发送的消息客户端是否能正常接收</p><h2 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h2><p>想要终止一个链接, 需要客户端 &#x2F; 服务端四次挥手的过程</p><h3 id="四次挥手过程"><a href="#四次挥手过程" class="headerlink" title="四次挥手过程"></a>四次挥手过程</h3><ol><li>第一次挥手, 客户端发送一个 FIN 报文, 报文中会指定一个序列号. 此时客户端进入 FIN_WAIT1 状态并停止发送数据. 待服务端回应</li><li>第二次挥手, 服务端接收到客户端 FIN 报文之后会回复 ACK 报文, 并把客户端 FIN 报文序列号 +1 作为回复的 ACK 报文序号值, 告知客户端已经收到断开链接的请求, 服务端进入 CLOSE_WAIT 的状态. 此时服务端并不会直接断开链接, 而是等待服务器所有的响应返回完毕后, 进行第三次挥手.</li><li>第三次挥手, 需要响应的数据响应完成, 服务端会给客户端发起一次 FIN 报文, 并且指定序列号. 服务器进入 LAST_ACK 状态</li><li>第四次挥手, 客户端接收到服务端发来的 FIN 后, 返回给他一个 ACK 报文作为应答, 并把服务端 FIN 报文的序列号+1 作为 ACK 报文的序列号. 此时客户端进入 TIME_WAIT 状态, 待确保服务端收到自己回应的 ACK 报文后断开链接进入 CCLOSED 状态, 服务端收到 ACK 报回应后也就关闭了链接. 进入 CLOSED 状态了</li></ol><p><img src="https://handle-note-img.niubishanshan.top/2021-12-10-10-33-01.png" alt="四次挥手"></p><h2 id="一次完整的会话"><a href="#一次完整的会话" class="headerlink" title="一次完整的会话"></a>一次完整的会话</h2><p><img src="https://handle-note-img.niubishanshan.top/2021-12-10-10-34-17.png" alt="一次完整的会话示意图"></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a></div><div class="post-nav"><div class="post-nav-item"><a href="/%E9%9D%A2%E8%AF%95/%E7%BD%91%E7%BB%9C/%E9%9D%A2%E8%AF%95/%E7%BD%91%E7%BB%9C/%E8%BE%93%E5%85%A5%20URL%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/" rel="prev" title="输入 URL敲下回车发生了什么"><i class="fa fa-chevron-left"></i> 输入 URL敲下回车发生了什么</a></div><div class="post-nav-item"> <a href="/%E9%9D%A2%E8%AF%95/webpack/%E9%9D%A2%E8%AF%95/webpack/webpack%20%E7%9A%84%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B/" rel="next" title="webpack 的构建流程">webpack 的构建流程<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>
  window.addEventListener('tabs:register', function() {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="nav-text">三次握手</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E8%BF%87%E7%A8%8B"><span class="nav-text">三次握手过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%BD%9C%E7%94%A8"><span class="nav-text">三次握手作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E4%B8%A4%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="nav-text">为什么不能两次握手</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="nav-text">四次挥手</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E8%BF%87%E7%A8%8B"><span class="nav-text">四次挥手过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E6%AC%A1%E5%AE%8C%E6%95%B4%E7%9A%84%E4%BC%9A%E8%AF%9D"><span class="nav-text">一次完整的会话</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="圈圈的圈" src="/images/avatar.png"><p class="site-author-name" itemprop="name">圈圈的圈</p><div class="site-description" itemprop="description">技术学习, 读书笔记, 生活感悟 ~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">142</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://juejin.im/user/5837c2bd61ff4b006ca8d1b2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5837c2bd61ff4b006ca8d1b2" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://github.com/luoquanquan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoquanquan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:luo_quanquan@163.com" title="E-Mail → mailto:luo_quanquan@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17034706号-1</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">圈圈的圈</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/js/theme-next-canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>
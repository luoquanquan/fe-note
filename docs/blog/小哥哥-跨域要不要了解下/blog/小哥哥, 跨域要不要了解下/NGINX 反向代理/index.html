<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("http://note.niubishanshan.top").hostname,root:"/",scheme:"Gemini",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.json",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="原本本系列文章是不打算详写 NGINX 反向代理的. 至于为什么不想写呢? 当然是因为我不太会咯~~ 但是, 不久前有大佬点了这道菜, 那当然就得上啦 😄"><meta property="og:type" content="article"><meta property="og:title" content="NGINX 反向代理"><meta property="og:url" content="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/NGINX%20%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/index.html"><meta property="og:site_name" content="圈圈的笔记"><meta property="og:description" content="原本本系列文章是不打算详写 NGINX 反向代理的. 至于为什么不想写呢? 当然是因为我不太会咯~~ 但是, 不久前有大佬点了这道菜, 那当然就得上啦 😄"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222357.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222428.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222438.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222447.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/cross-domain4.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222546.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222559.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222610.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222646.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/cross-domain5.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222756.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222809.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222816.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222832.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222847.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222857.png"><meta property="article:published_time" content="2018-12-10T14:22:22.000Z"><meta property="article:modified_time" content="2024-06-27T15:04:43.276Z"><meta property="article:author" content="圈圈的圈"><meta property="article:tag" content="blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://handle-note-img.niubishanshan.top/20240627222357.png"><link rel="canonical" href="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/NGINX%20%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>NGINX 反向代理 | 圈圈的笔记</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a target="_blank" rel="noopener" href="https://github.com/luoquanquan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">圈圈的笔记</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">路漫漫其修远兮, 吾将上下而求索</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/NGINX%20%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="圈圈的圈"><meta itemprop="description" content="技术学习, 读书笔记, 生活感悟 ~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="圈圈的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> NGINX 反向代理</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-12-10 22:22:22" itemprop="dateCreated datePublished" datetime="2018-12-10T22:22:22+08:00">2018-12-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-27 23:04:43" itemprop="dateModified" datetime="2024-06-27T23:04:43+08:00">2024-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/" itemprop="url" rel="index"><span itemprop="name">blog</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/" itemprop="url" rel="index"><span itemprop="name">小哥哥, 跨域要不要了解下</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>原本本系列文章是不打算详写 NGINX 反向代理的. 至于为什么不想写呢? 当然是因为我不太会咯~~</p><p>但是, 不久前有大佬点了这道菜, 那当然就得上啦 😄</p></blockquote><span id="more"></span><p><img src="https://handle-note-img.niubishanshan.top/20240627222357.png" alt="20240627222357"></p><h2 id="代理是个啥"><a href="#代理是个啥" class="headerlink" title="代理是个啥"></a>代理是个啥</h2><p>既然要聊反向代理, 那首先得知道代理是个啥吧? 嗯.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627222428.png" alt="20240627222428"></p><h3 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h3><p>比如, 你买束花, 想要给隔壁工位的测试妹子小丽表白. 但是又怕被人家直面拒绝太没面子. 于是你把鲜花委托给平时和小丽一起的测试小伙伴小红. 让她帮忙把花送给小丽. 这就是一个简单的代理过程, 小红作为代理帮你把花送给了小丽, 当然这种情况在现实中并不推荐使用, 因为难以避免中间商赚差价 😂.</p><p>在上面的例子中, 你作为客户端(请求方), 想要向服务方(小丽)发起请求. 但是碍于面子你主动找到了第三方(小红)作为代理向服务方发送请求, 这种情况就是常说的<code>正向代理</code>. 正向代理在互联网中的使用主要是科学上网, 你想访问谷歌但是碍于防火墙你只能通过vpn服务器作为代理才能访问. 这个时候一般也要找值得信赖的vpn厂商, 避免中间商赚差价 😄.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627222438.png" alt="20240627222438"></p><h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>关于反向代理的例子, 那就比较多啦. 比如, 孤独的你躺在床上夜不能寐. 于是乎, 拿出手机, 点亮了屏幕, 拨通 <code>10086</code>, 中国移动就会随机分配一个当前处于空闲的客服MM, 你可以和客服MM聊聊天, 问问她家住哪里, 有没有男朋友, 她的微信号, 她的手机号, 星座, 八字…….</p><p>在这个例子中, 中国移动就充当了反向代理的角色. 你只需要拨打 <code>10086</code>. 至于会不会分配到 MM 会分配到哪个 MM 在接通之前你都是不知道的. 反向代理在互联网中的使用主要是实现负载均衡. 当你访问某个网站的时候, 反向代理服务器会从当前网站的所有服务器中选择一个空闲的服务器为你响应. 用于均衡每台服务器的负载率.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627222447.png" alt="20240627222447"></p><h2 id="修改-hosts-完成域名绑定"><a href="#修改-hosts-完成域名绑定" class="headerlink" title="修改 hosts 完成域名绑定"></a>修改 hosts 完成域名绑定</h2><p>mac 用户直接执行 <code>vim /private/etc/hosts</code> 在 hosts 文件最后添加一行:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 a.com</span><br></pre></td></tr></table></figure><p>这一句是什么意思呢? 就是告诉我们的电脑访问 <code>a.com</code> 的时候, 无需请求 DNS, 直接指向我们本机.</p><p>ps: win 环境下, hosts 文件在 <code>C:\Windows\System32\drivers\etc</code> 文件夹下. 如果没有权限修改, 把 hosts 文件先拷贝到别的位置, 通过编辑器打开并添加最后一行内容以后再剪切到原来的位置替换即可.</p><p>验证: 打开命令行窗口执行 <code>ping a.com</code>, 如果访问的 ip 为 127.0.0.1 说明我们的域名绑定就完成啦 ^_^</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/cross-domain4.gif"></p><h2 id="安装-nginx"><a href="#安装-nginx" class="headerlink" title="安装 nginx"></a>安装 nginx</h2><blockquote><p>要做 NGINX 反向代理, 肯定要安装 <a target="_blank" rel="noopener" href="http://nginx.org/">nginx</a>, 本文安装步骤示例环境为 mac, win 的小伙伴, 可以百度一下嗷, 这个东西大同小异.</p></blockquote><ul><li>安装 brew 命令, 执行 <code>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code></li><li>安装 nginx, 执行 <code>brew install nginx</code></li><li>启动 nginx <code>nginx</code>, 如果报没有权限, 执行 <code>sudo nginx</code></li></ul><p>nginx 启动后, 浏览器打开 <a target="_blank" rel="noopener" href="http://localhost:8080/">localhost:8080</a>, 即可验证. 出现以下界面说明安装成功.<br><img src="https://handle-note-img.niubishanshan.top/20240627222546.png" alt="20240627222546"></p><h2 id="nginx-配置初探"><a href="#nginx-配置初探" class="headerlink" title="nginx 配置初探"></a>nginx 配置初探</h2><p>配置完 hosts 域名已经能够成功绑定. 现在如果我们访问 <code>a.com</code> 实际上是会访问到我们的自己的电脑辣. 那还不抓紧试一下?</p><p>浏览器访问 <a target="_blank" rel="noopener" href="http://a.com/">a.com</a></p><p><img src="https://handle-note-img.niubishanshan.top/20240627222559.png" alt="20240627222559"></p><p>这是什么鬼????<br><img src="https://handle-note-img.niubishanshan.top/20240627222610.png" alt="20240627222610"></p><p>为什么会 <strong>无法访问此网站</strong> 呢? 我们下载安装完 nginx 还没有做任何配置. 接下来, 我们稍微配置一下就 OK:</p><ul><li>命令行切换到 nginx 配置目录下 <code>cd /usr/local/etc/nginx/servers</code></li><li>创建并编辑配置文件 <code>vim test.conf</code>, 在配置文件中粘贴以下内容</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    # 监听80端口号</span><br><span class="line">    listen 80;</span><br><span class="line"></span><br><span class="line">    # 监听访问的域名</span><br><span class="line">    server_name a.com;</span><br><span class="line"></span><br><span class="line">    # 根据访问路径配置</span><br><span class="line">    location / &#123;</span><br><span class="line">        # 把请求转发到 https://www.baidu.com</span><br><span class="line">        proxy_pass https://www.baidu.com;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>保存文件, 并执行 <code>nginx -s reload</code> 重启 nginx. (此处原本有一个拼写错误, 感谢<a target="_blank" rel="noopener" href="https://juejin.im/user/58f56b4b0ce463006bc084eb">StanYe</a>小伙伴提出 😄)</li><li>回到浏览器, 打开 a.com 的页签, 强制刷新.<br><img src="https://handle-note-img.niubishanshan.top/20240627222646.png" alt="20240627222646"></li></ul><p>恭喜你已经完成了第一个 nginx 配置.</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/cross-domain5.gif"></p><h2 id="创建跨域环境"><a href="#创建跨域环境" class="headerlink" title="创建跨域环境"></a>创建跨域环境</h2><blockquote><p>通过一系列的折腾, 我们已经可以通过 nginx 将<code>a.com</code> 转发到百度. 完成了第一步, 接下来我们创建跨域的 Case 并一步一步通过 nginx 配置实现跨域.</p></blockquote><p>首先, 项目前后端添加 nginx 目录, 用户存放前后端代码. 代码结构如下图所示.<br><img src="https://handle-note-img.niubishanshan.top/20240627222756.png" alt="20240627222756"></p><p>其次编写前后端代码:</p><p>前端代码(<code>./fe/nginx/index.html</code>):</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CORS 实现跨域<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>CORS 实现跨域<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://localhost:8888/api/getFriend&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;quanquanbunengshuo&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="property">withCredentials</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(xhr.<span class="property">readyState</span> === <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="title function_">getAllResponseHeaders</span>())</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">send</span>()</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>编写完前端代码以后, 启动前端 web 容器. <code>live-server ./fe/nginx</code><br><img src="https://handle-note-img.niubishanshan.top/20240627222809.png" alt="20240627222809"></p><p>命令行中出现了黄色警告, 通知我们 8080 端口已经被占用, 这又是为什么呢? 大家请思考一哈.<br><img src="https://handle-note-img.niubishanshan.top/20240627222816.png" alt="20240627222816"></p><p>我们重新指定一个端口<code>live-server ./fe/nginx --port=9999</code> 哈哈, 换一个指令, 依旧是那么顺畅. ^_^</p><p>后端代码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 http 服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(request.<span class="property">headers</span>)</span><br><span class="line">  response.<span class="title function_">end</span>(<span class="string">&quot;&#123;name: &#x27;quanquan&#x27;, friend: &#x27;guiling&#x27;&#125;&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务, 监听端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动成功, 正在监听: &#x27;</span>, <span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>启动后端服务 <code>node ./be/nginx/index.js</code></p><h2 id="完善-nginx-配置"><a href="#完善-nginx-配置" class="headerlink" title="完善 nginx 配置"></a>完善 nginx 配置</h2><blockquote><p>前后端代码已经准备完成, 这一步我们就来点干货. 完成最后的配置.</p></blockquote><ul><li>首先, 修改 nginx 配置, 把百度地址替换成本地的前端地址</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    # 监听80端口号</span><br><span class="line">    listen 80;</span><br><span class="line"></span><br><span class="line">    # 监听访问的域名</span><br><span class="line">    server_name a.com;</span><br><span class="line"></span><br><span class="line">    # 根据访问路径配置</span><br><span class="line">    location / &#123;</span><br><span class="line">        # 把请求转发到 http://127.0.0.1:9999</span><br><span class="line">        proxy_pass http://127.0.0.1:9999;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>修改完成 nginx 配置文件以后, 切记执行 <code>nginx -s -reload</code> 重启 nginx.</li><li>访问<a target="_blank" rel="noopener" href="http://a.com/">a.com</a></li></ul><p><img src="https://handle-note-img.niubishanshan.top/20240627222832.png" alt="20240627222832"></p><p>熟悉的报错又出现了…</p><ul><li>修改前端项目中的接口地址</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口地址修改为当前域名下 /api 路劲下的 getFriend</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/api/getFriend&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>修改 nginx 配置文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    # 监听80端口号</span><br><span class="line">    listen 80;</span><br><span class="line"></span><br><span class="line">    # 监听访问的域名</span><br><span class="line">    server_name a.com;</span><br><span class="line"></span><br><span class="line">    # 根据访问路径配置</span><br><span class="line">    location / &#123;</span><br><span class="line">        # 把请求转发到 http://127.0.0.1:9999</span><br><span class="line">        proxy_pass http://127.0.0.1:9999;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 监听根目录下的 /api 路径</span><br><span class="line">    location /api/ &#123;</span><br><span class="line">        # 把请求转发到 http://127.0.0.1:8888</span><br><span class="line">        proxy_pass http://127.0.0.1:8888;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新加的对于 api 路径的监听的意思就是把关于后端 api 的请求转发到后端项目上(哈哈, 当然这就是为啥好多后端接口都是要有 <code>/api</code> 开头的啦). 重启 nginx 以后, 再次刷新浏览器, 后端返回的结果已经成功的打印到了控制台, 本次跨域访问任务完成.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627222847.png" alt="20240627222847"></p><p>细心的小伙伴肯定发现了, 控制台还有一个报错. 这个是因为我们的项目中用到了 <code>live-server</code> 这个工具需要 websocket 导致的. 我们可以通过添加以下配置解决.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_http_version 1.1;</span><br><span class="line">proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">proxy_set_header Connection &quot;upgrade&quot;;</span><br></pre></td></tr></table></figure><p><img src="https://handle-note-img.niubishanshan.top/20240627222857.png" alt="20240627222857"></p><p>报错消失 😄, 此时完整的 nginx 配置文件为</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    # 监听80端口号</span><br><span class="line">    listen 80;</span><br><span class="line"></span><br><span class="line">    # 监听访问的域名</span><br><span class="line">    server_name a.com;</span><br><span class="line"></span><br><span class="line">    # 根据访问路径配置</span><br><span class="line">    location / &#123;</span><br><span class="line">        # 把请求转发到 http://127.0.0.1:9999</span><br><span class="line">        proxy_pass http://127.0.0.1:9999;</span><br><span class="line"></span><br><span class="line">        # 兼容websocket</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 监听根目录下的 /api 路径</span><br><span class="line">    location /api/ &#123;</span><br><span class="line">        # 把请求转发到 http://127.0.0.1:8888</span><br><span class="line">        proxy_pass http://localhost:8888;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前后端代码地址为: <a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/f38f56689fdac1526244ecadaa979a52c9c4a7ea">github</a></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>至此, 我们已经通过 nginx 反向代理的方式实现了跨域访问 api, 在系列文章<a target="_blank" rel="noopener" href="https://juejin.im/post/5c07fa04e51d451de968906b">第一篇</a>对于跨域的解释为: 跨域源于同源策略, 是浏览器保证用户安全的行为. 我们使用的 nginx 反向代理实际上是对浏览器的一种 “哄骗”, 让它认为自己访问到的是同域的 api. 实际上是在服务端做了个调包, 这个道理就如同你拨打 10086 你就认定了给你分配到的一定是中国移动的客服MM(客服GG也是有可能出现的 😄)而中国移动的客服MM就是一个很安全的聊天对象, 没有必要再进行限制…</p><p>下集预告: 终于蹩脚的码完了最后一行, 作为生产环境中最常用的 nginx 反向代理, 比我想象的要简单很多很多. 由于涉及到诸多配置的步骤. 有写的不明白的地方还望小伙伴们评论区一起讨论. 下一节预计聊聊服务端代理 <code>ServerProxy</code> 这个也是我要做的<a target="_blank" rel="noopener" href="https://juejin.im/post/5bfd43986fb9a049ed308f1a">接口测试工具</a>需要用到的技术方案, See you.</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/blog/" rel="tag"># blog</a></div><div class="post-nav"><div class="post-nav-item"><a href="/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/CORS%20%E8%BF%9B%E9%98%B6%E7%AF%87/" rel="prev" title="CORS 进阶篇"><i class="fa fa-chevron-left"></i> CORS 进阶篇</a></div><div class="post-nav-item"> <a href="/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/ServerProxy/" rel="next" title="ServerProxy">ServerProxy<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>
  window.addEventListener('tabs:register', function() {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%90%86%E6%98%AF%E4%B8%AA%E5%95%A5"><span class="nav-text">代理是个啥</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86"><span class="nav-text">正向代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="nav-text">反向代理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9-hosts-%E5%AE%8C%E6%88%90%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A"><span class="nav-text">修改 hosts 完成域名绑定</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-nginx"><span class="nav-text">安装 nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx-%E9%85%8D%E7%BD%AE%E5%88%9D%E6%8E%A2"><span class="nav-text">nginx 配置初探</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%B7%A8%E5%9F%9F%E7%8E%AF%E5%A2%83"><span class="nav-text">创建跨域环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E5%96%84-nginx-%E9%85%8D%E7%BD%AE"><span class="nav-text">完善 nginx 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="圈圈的圈" src="/images/avatar.png"><p class="site-author-name" itemprop="name">圈圈的圈</p><div class="site-description" itemprop="description">技术学习, 读书笔记, 生活感悟 ~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">142</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://juejin.im/user/5837c2bd61ff4b006ca8d1b2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5837c2bd61ff4b006ca8d1b2" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://github.com/luoquanquan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoquanquan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:luo_quanquan@163.com" title="E-Mail → mailto:luo_quanquan@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17034706号-1</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">圈圈的圈</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/js/theme-next-canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>
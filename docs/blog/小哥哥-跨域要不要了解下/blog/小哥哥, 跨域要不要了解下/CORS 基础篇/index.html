<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("http://note.niubishanshan.top").hostname,root:"/",scheme:"Gemini",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.json",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="在前一篇文章中, 我们一起学习了第一种跨域处理方案 JSONP. 这种方法相对比较原始, 优点是兼容性好, 就连现代前端没怎么听说过的 IE 6 上跑起来都是妥妥的. 然鹅, 它也就这一点优点了. 其缺点有: 只支持 GET 请求, 配置繁琐(前后端都需要调整代码), 在 window 上注册各种回调函数, 开发体验差….  CORS由于 JSONP 的方案存在诸多缺点且老旧, 这里我们一起学习"><meta property="og:type" content="article"><meta property="og:title" content="CORS 基础篇"><meta property="og:url" content="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/CORS%20%E5%9F%BA%E7%A1%80%E7%AF%87/index.html"><meta property="og:site_name" content="圈圈的笔记"><meta property="og:description" content="在前一篇文章中, 我们一起学习了第一种跨域处理方案 JSONP. 这种方法相对比较原始, 优点是兼容性好, 就连现代前端没怎么听说过的 IE 6 上跑起来都是妥妥的. 然鹅, 它也就这一点优点了. 其缺点有: 只支持 GET 请求, 配置繁琐(前后端都需要调整代码), 在 window 上注册各种回调函数, 开发体验差….  CORS由于 JSONP 的方案存在诸多缺点且老旧, 这里我们一起学习"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173654.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173815.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173825.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173849.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173856.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173916.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173930.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173943.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627174149.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627174207.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627174222.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627174233.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627174243.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627174253.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627174302.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/cross-domain2.gif"><meta property="article:published_time" content="2018-12-07T09:35:46.000Z"><meta property="article:modified_time" content="2024-06-27T15:04:43.276Z"><meta property="article:author" content="圈圈的圈"><meta property="article:tag" content="blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://handle-note-img.niubishanshan.top/20240627173654.png"><link rel="canonical" href="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/CORS%20%E5%9F%BA%E7%A1%80%E7%AF%87/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>CORS 基础篇 | 圈圈的笔记</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a target="_blank" rel="noopener" href="https://github.com/luoquanquan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">圈圈的笔记</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">路漫漫其修远兮, 吾将上下而求索</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/CORS%20%E5%9F%BA%E7%A1%80%E7%AF%87/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="圈圈的圈"><meta itemprop="description" content="技术学习, 读书笔记, 生活感悟 ~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="圈圈的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> CORS 基础篇</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-12-07 17:35:46" itemprop="dateCreated datePublished" datetime="2018-12-07T17:35:46+08:00">2018-12-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-27 23:04:43" itemprop="dateModified" datetime="2024-06-27T23:04:43+08:00">2024-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/" itemprop="url" rel="index"><span itemprop="name">blog</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/" itemprop="url" rel="index"><span itemprop="name">小哥哥, 跨域要不要了解下</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>在<a target="_blank" rel="noopener" href="https://juejin.im/post/5c07fa04e51d451de968906b">前一篇文章</a>中, 我们一起学习了第一种跨域处理方案 <code>JSONP</code>. 这种方法相对比较原始, 优点是兼容性好, 就连现代前端没怎么听说过的 <code>IE 6</code> 上跑起来都是妥妥的. 然鹅, 它也就这一点优点了. 其缺点有: 只支持 GET 请求, 配置繁琐(前后端都需要调整代码), 在 window 上注册各种回调函数, 开发体验差….</p></blockquote><h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p>由于 JSONP 的方案存在诸多缺点且老旧, 这里我们一起学习一种比较现代的跨域问题解决方案—CORS</p><span id="more"></span><p><img src="https://handle-note-img.niubishanshan.top/20240627173654.png" alt="20240627173654"></p><h3 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h3><p>从 mdn 官网粘来的兼容性列表如下:</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173815.png" alt="20240627173815"></p><p>ie 10 都可以跑, 足以满足现代前端开发者的需求了.</p><h3 id="概念-😳"><a href="#概念-😳" class="headerlink" title="概念 😳"></a>概念 😳</h3><p>概念性的东西<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">在这儿</a> MDN 偶尔需要梯子, 自备哈.</p><h3 id="搭建跨域的环境"><a href="#搭建跨域的环境" class="headerlink" title="搭建跨域的环境"></a>搭建跨域的环境</h3><p>我们先创建一个跨域的环境, 代码基于我们 jsonp 时候的示例项目 <a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain.git">cross-domain</a>, 首先, 在 fe 和 be 目录下创建 cors 目录. 其次, 分别添加 <code>index.html</code> 和 <code>index.js</code>. 修改以后的项目目录如下图.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173825.png" alt="20240627173825"></p><p>编写前端代码 <code>fe/cors/index.html</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CORS 实现跨域<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>CORS 实现跨域<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://localhost:8888&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(xhr.<span class="property">readyState</span> === <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        xhr.<span class="title function_">send</span>()</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>一个灰常简单的 ajax 请求, 有木有.</p><p>后端代码 <code>be/cors/index.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 http 服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  response.<span class="title function_">end</span>(<span class="string">&quot;&#123;name: &#x27;quanquan&#x27;, friend: &#x27;guiling&#x27;&#125;&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务, 监听端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动成功, 正在监听: &#x27;</span>, <span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>此时的<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/483808571faf3cadc886033c2214a2b6f25b08fa">项目代码</a></p><h3 id="找点苗头"><a href="#找点苗头" class="headerlink" title="找点苗头"></a>找点苗头</h3><p>代码环境准备完成后</p><ul><li>首先启动后端代码 <code>node ./be/cors/index.js</code></li><li>其次启动前端 web 容器 <code>live-server ./fe/cors</code></li><li>打开浏览器, 访问 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080/</a></li><li>打开控制台, 切换到 Console tab</li><li>刷新浏览器</li></ul><p><img src="https://handle-note-img.niubishanshan.top/20240627173849.png" alt="20240627173849"></p><p>我们细细分析这个熟悉的报错, 前一段告诉我们我们的请求被 block 了. 后边居然直接告诉我们解决方案了, 方案了 <code>&#39;Access-Control-Allow-Origin&#39; header is present on the requested resource.</code>, 这么明显的暗示, 难道我们就不试试???</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173856.png" alt="20240627173856"></p><h3 id="响应头添加-Access-Control-Allow-Origin"><a href="#响应头添加-Access-Control-Allow-Origin" class="headerlink" title="响应头添加 Access-Control-Allow-Origin"></a>响应头添加 Access-Control-Allow-Origin</h3><p>针对浏览器的报错, 我们分析出他是要我们在响应头上添加<code>Access-Control-Allow-Origin</code>这个字段,<br>那么我们修改我们的后端代码.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 http 服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">  response.<span class="title function_">end</span>(<span class="string">&quot;&#123;name: &#x27;quanquan&#x27;, friend: &#x27;guiling&#x27;&#125;&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务, 监听端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动成功, 正在监听: &#x27;</span>, <span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>改动后的<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/9aff17ce9a1facb0ca643a233bbe30a8741d08e1">代码</a>.</p><div style="font-weight:700;font-size:20px">巨大的 PS: 修改过后端代码以后, 一定要<span style="color:red">重启 node 服务</span></div><p>浏览器刷新一下, 我了个乖乖. 好了 😄</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173916.png" alt="20240627173916"></p><p>开心过后, 我们想一下, jsonp 的缺点是只能支持 GET 请求, 作为<code>现代</code>的跨域请求方式. cors 能不能支持其他的请求方式呢?</p><h3 id="其他请求方式的支持"><a href="#其他请求方式的支持" class="headerlink" title="其他请求方式的支持"></a>其他请求方式的支持</h3><p>作为<code>现代</code>的跨域问题解决方案, 应该是能解决多种请求方式的. 光说不练假把式. 咱们试试 😄</p><p>改动前端代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 改动前</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://localhost:8888&#x27;</span>)</span><br><span class="line"><span class="comment">// 改动后</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:8888&#x27;</span>)</span><br></pre></td></tr></table></figure><p>修改后<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/8494d3543b9919bf58ab1c3d9c72d41d97a7cbaa">代码</a>来浏览器上看一下?</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173930.png" alt="20240627173930"></p><p>木有任何问题, 返回的数据顺利的打印. 没有任何的报错.</p><p>趁着兴头试试<code>PUT</code>请求</p><p>再次改动前端代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 改动前</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:8888&#x27;</span>)</span><br><span class="line"><span class="comment">// 改动后</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;PUT&#x27;</span>, <span class="string">&#x27;http://localhost:8888&#x27;</span>)</span><br></pre></td></tr></table></figure><p>修改后<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/8494d3543b9919bf58ab1c3d9c72d41d97a7cbaa">代码</a>来浏览器上看一下?</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173943.png" alt="20240627173943"></p><p>哎呀我滴妈? 很眼熟的错误, 但是不要认错人哈, 这次的报错和之前的报错长的很像, 但是关键词不一样了. 根据之前的经验, 后端添加 <code>Access-Control-Allow-Methods</code> 响应头应该好使.</p><p>后端代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 http 服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>);</span><br><span class="line">  response.<span class="title function_">end</span>(<span class="string">&quot;&#123;name: &#x27;quanquan&#x27;, friend: &#x27;guiling&#x27;&#125;&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务, 监听端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动成功, 正在监听: &#x27;</span>, <span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>修改后<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/b50d23491506b9cd2c52dc36155c57e07c18f2ed">代码</a>来浏览器上看一下?</p><p><img src="https://handle-note-img.niubishanshan.top/20240627174149.png" alt="20240627174149"></p><p>成功了 😄</p><p><img src="https://handle-note-img.niubishanshan.top/20240627174207.png" alt="20240627174207"></p><p>其他的 http 方法和 <code>PUT</code> 方法处理的方式是一样的. 举一反三即可.</p><h3 id="后端说-你的请求要加一个-token-呀"><a href="#后端说-你的请求要加一个-token-呀" class="headerlink" title="后端说, 你的请求要加一个 token 呀"></a>后端说, 你的请求要加一个 token 呀</h3><p>既然是现代的开发, 那么会话的管理一般是会用 jwt(后续可能会写相关的文章), jwt 一个闪耀的标志就是请求头添加了 jwt token. 明人不说暗话.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627174222.png" alt="20240627174222"></p><p>修改前端代码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加了一行</span></span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;quanquanbunengshuo&#x27;</span>)</span><br></pre></td></tr></table></figure><p>修改后<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/b4b372173f6c8c5645b5e8cc4e79b9f41e22a9ce">代码</a>来浏览器上看一下?</p><p><img src="https://handle-note-img.niubishanshan.top/20240627174233.png" alt="20240627174233"></p><p>相信大家已经摸清了我的套路, 闲话不扯.</p><p>后端代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加了一行</span></span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;token&#x27;</span>);</span><br></pre></td></tr></table></figure><p>修改后<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/11686561e729075da6c5d7d1c64470e08ad790e8">代码</a>来浏览器上看一下?</p><p><img src="https://handle-note-img.niubishanshan.top/20240627174243.png" alt="20240627174243"></p><p>目前为止, 跨域请求成功了, 请求方式兼容了, 自定义请求头好使了. 是不是大吉大利, 可以吃鸡了呢?</p><h3 id="致-被打入冷宫的-Network-tab"><a href="#致-被打入冷宫的-Network-tab" class="headerlink" title="致, 被打入冷宫的 Network tab"></a>致, 被打入冷宫的 Network tab</h3><p>我们自始至终都在查看浏览器的 Console tab, 作为一个通信性质的文章, 不看一下 Network 明显有点说不过去辣.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627174253.png" alt="20240627174253"></p><p>既然存在, 那肯定是要看看的, 我们把 tab 切换到 Network.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627174302.png" alt="20240627174302"></p><p>哎呦喂? 两个请求, 一个 OPTIONS 一个 PUT, 这是什么鬼?</p><p>下集预告: 刚刚看到了 Network 就出现了血案. 当然如果仅仅是停留在会用 CORS 实现跨域上, 到目前为止已经没有什么问题了, <b>用来面试也是杠杠滴</b>. 下一步, 我们一起探讨 CORS 条件下, <code>预检请求</code> 和 <code>Cookie</code> 携带那些事儿. 周五码字感觉好累…… 约小姐姐去辣 😄</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/cross-domain2.gif"></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/blog/" rel="tag"># blog</a></div><div class="post-nav"><div class="post-nav-item"><a href="/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/%E7%AC%AC%E4%BA%94%E6%AD%A5,%20%E6%92%B8%E5%AE%8C%E6%94%B6%E5%B7%A5/" rel="prev" title="第五步, 撸完收工"><i class="fa fa-chevron-left"></i> 第五步, 撸完收工</a></div><div class="post-nav-item"> <a href="/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/CORS%20%E8%BF%9B%E9%98%B6%E7%AF%87/" rel="next" title="CORS 进阶篇">CORS 进阶篇<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>
  window.addEventListener('tabs:register', function() {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#CORS"><span class="nav-text">CORS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="nav-text">兼容性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5-%F0%9F%98%B3"><span class="nav-text">概念 😳</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E8%B7%A8%E5%9F%9F%E7%9A%84%E7%8E%AF%E5%A2%83"><span class="nav-text">搭建跨域的环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%BE%E7%82%B9%E8%8B%97%E5%A4%B4"><span class="nav-text">找点苗头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%A4%B4%E6%B7%BB%E5%8A%A0-Access-Control-Allow-Origin"><span class="nav-text">响应头添加 Access-Control-Allow-Origin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%E7%9A%84%E6%94%AF%E6%8C%81"><span class="nav-text">其他请求方式的支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF%E8%AF%B4-%E4%BD%A0%E7%9A%84%E8%AF%B7%E6%B1%82%E8%A6%81%E5%8A%A0%E4%B8%80%E4%B8%AA-token-%E5%91%80"><span class="nav-text">后端说, 你的请求要加一个 token 呀</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%B4-%E8%A2%AB%E6%89%93%E5%85%A5%E5%86%B7%E5%AE%AB%E7%9A%84-Network-tab"><span class="nav-text">致, 被打入冷宫的 Network tab</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="圈圈的圈" src="/images/avatar.png"><p class="site-author-name" itemprop="name">圈圈的圈</p><div class="site-description" itemprop="description">技术学习, 读书笔记, 生活感悟 ~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">142</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://juejin.im/user/5837c2bd61ff4b006ca8d1b2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5837c2bd61ff4b006ca8d1b2" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://github.com/luoquanquan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoquanquan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:luo_quanquan@163.com" title="E-Mail → mailto:luo_quanquan@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17034706号-1</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">圈圈的圈</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/js/theme-next-canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>
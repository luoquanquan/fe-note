<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("http://note.niubishanshan.top").hostname,root:"/",scheme:"Gemini",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.json",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="随手整理了一下常用的跨域方式处理方案, 这里马上分享给大家 😋  ps: 为了保证前后端编码的一致性, 本系列文章中涉及部分后端内容. 后端统一使用原生 nodejs 来搞, 请奔走相告. 准备工作为了托管我们的静态页面, 我们需要一个可以提供服务器环境的插件, 这里推荐 live-server, 通过命令 npm i -g live-server 安装即可. 该插件支持html文件热更新."><meta property="og:type" content="article"><meta property="og:title" content="JSONP"><meta property="og:url" content="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/JSONP/index.html"><meta property="og:site_name" content="圈圈的笔记"><meta property="og:description" content="随手整理了一下常用的跨域方式处理方案, 这里马上分享给大家 😋  ps: 为了保证前后端编码的一致性, 本系列文章中涉及部分后端内容. 后端统一使用原生 nodejs 来搞, 请奔走相告. 准备工作为了托管我们的静态页面, 我们需要一个可以提供服务器环境的插件, 这里推荐 live-server, 通过命令 npm i -g live-server 安装即可. 该插件支持html文件热更新."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/cross-domain.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173134.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/cross-domain1.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173240.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173255.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173333.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173348.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173403.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173414.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173430.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173437.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627173450.png"><meta property="article:published_time" content="2021-01-15T09:13:26.000Z"><meta property="article:modified_time" content="2024-06-27T15:04:43.276Z"><meta property="article:author" content="圈圈的圈"><meta property="article:tag" content="blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://handle-note-img.niubishanshan.top/gifs/cross-domain.gif"><link rel="canonical" href="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/JSONP/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>JSONP | 圈圈的笔记</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a target="_blank" rel="noopener" href="https://github.com/luoquanquan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">圈圈的笔记</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">路漫漫其修远兮, 吾将上下而求索</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/JSONP/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="圈圈的圈"><meta itemprop="description" content="技术学习, 读书笔记, 生活感悟 ~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="圈圈的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> JSONP</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-01-15 17:13:26" itemprop="dateCreated datePublished" datetime="2021-01-15T17:13:26+08:00">2021-01-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-27 23:04:43" itemprop="dateModified" datetime="2024-06-27T23:04:43+08:00">2024-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/" itemprop="url" rel="index"><span itemprop="name">blog</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/" itemprop="url" rel="index"><span itemprop="name">小哥哥, 跨域要不要了解下</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>随手整理了一下常用的跨域方式处理方案, 这里马上分享给大家 😋</p></blockquote><p>ps: 为了保证前后端编码的一致性, 本系列文章中涉及部分后端内容. 后端统一使用原生 nodejs 来搞, 请奔走相告.</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>为了托管我们的静态页面, 我们需要一个可以提供服务器环境的插件, 这里推荐 <code>live-server</code>, 通过命令 <code>npm i -g live-server</code> 安装即可. 该插件支持html文件热更新. 那用户体验简直飞起. 一键启动, 只需要在需要托管的目录执行 <code>live-server .</code> 即可.</p><span id="more"></span><p><img src="https://handle-note-img.niubishanshan.top/gifs/cross-domain.gif" alt="cross-domain"></p><p>ps: <code>live-server</code> 依赖 nodejs, 没有安装的小伙伴, 请参照<a target="_blank" rel="noopener" href="https://juejin.im/post/5bfd43986fb9a049ed308f1a">这篇文章</a>安装 nodejs.</p><h2 id="AJAX-访问接口跨域解决方案"><a href="#AJAX-访问接口跨域解决方案" class="headerlink" title="AJAX 访问接口跨域解决方案"></a>AJAX 访问接口跨域解决方案</h2><p>首先, 更正几个常见的错误认识:</p><ol><li>同源策略是浏览器的行为, 和 js 关系不大.</li><li>所谓跨域是指请求发起方页面所在的 url 与访问的 api 存在协议, 域名, 端口中任意一个不同即视为跨域. 并不单单是指域名.</li><li>跨域这个东西, 日常工作中并不是很常用. 你想, 谁会闲的没事儿干总是请求人家别人的 api 去.</li></ol><h2 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h2><blockquote><p>可能有小伙伴会说. 圈圈, 你扯淡, 既然浏览器有跨域限制. 为什么我司项目从 <a target="_blank" rel="noopener" href="https://www.bootcdn.cn/">bootcdn</a>, 引入的 jquery 依然跑在信息高速路上, 没有任何低头的意思?</p></blockquote><p>hhh, 😄. 这个质疑提的好. 浏览器同源策略禁止的是 ajax 请求. 然鹅, jquery 是一个 js 文件. 不受该策略的限制.</p><p>我尼玛, 那到底是啥限制啥不限制嘛???</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173134.png" alt="20240627173134"></p><p>根据 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy">MDN</a> (自备梯子), 对于浏览器的同源策略的解释, 不受限制的外域资源加载情况有以下几种:</p><ul><li>script</li><li>link</li><li>img</li><li>video</li><li>object embed applet</li><li>font-face 有的浏览器允许, 有的禁止</li><li>frame</li></ul><p>那么问题来了, 挖掘机学校…, 不好意思走错片场了. 既然有这么多方式可以绕过浏览器同源策略的限制. 那么, 是不是我们可以做一点事情呢 ^_^</p><p>答: 是的 😄.</p><p>那还不抓紧搞起来?</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/cross-domain1.gif" alt="搞起来"></p><p>我们使用第一个特例 <code>script</code> 一步一步实现跨域访问 (jsonp).</p><ul><li>首先, 创建本次文章的项目目录<br><img src="https://handle-note-img.niubishanshan.top/20240627173240.png" alt="20240627173240"><br>目录中, be 代表是后端项目, fe 代表前端项目. jsonp 目录说明我们是用 jsonp 的方式实现跨域.</li><li>在项目根目录下执行 <code>live-server ./fe/jsonp/</code> 启动前端 web 容器</li><li>编辑 <code>./fe/jsonp/</code> 目录下的 index.html 文件. 代码如下:</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>jsonp 实现跨域<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>jsonp 实现跨域<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>浏览器访问 <a target="_blank" rel="noopener" href="http://localhost:8080/">localhost:8080</a>浏览器如下图说明前端 web 容器部署成功.</li></ul><p><img src="https://handle-note-img.niubishanshan.top/20240627173255.png" alt="20240627173255"></p><ul><li>编写后端代码, 编写 <code>be/jsonp/index.js</code> 文件, 文件内容如下</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">PORT</span> = <span class="number">8888</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 http 服务</span></span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>(<span class="keyword">function</span>(<span class="params">request, response</span>) &#123;</span><br><span class="line">    response.<span class="title function_">end</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务, 监听端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动成功, 正在监听: &#x27;</span>, <span class="variable constant_">PORT</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>编写完成后命令行执行 <code>node ./be/jsonp/index.js</code> 命令行中出现</li></ul><p><img src="https://handle-note-img.niubishanshan.top/20240627173333.png" alt="20240627173333"></p><p>说明后端程序启动成功.此时可以通过浏览器访问 <a target="_blank" rel="noopener" href="http://localhost:8888/">localhost:8888</a>获得 hello world</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173348.png" alt="20240627173348"></p><ul><li>下来, 我们在前端的 <code>index.html</code> 中尝试通过 ajax 请求 <code>http://localhost:8888/</code> 来获取返回数据, 添加如下代码, 添加以后<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/cce37cc50db74d0584f55da393d948c1dcfa7696">代码</a></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://localhost:8888/&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">send</span>()</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>回到浏览器, 查看页面控制台, 熟悉的错误出现了. Access to XMLHttpRequest at <code>http://localhost:8888/</code> from origin <code>http://127.0.0.1:8080</code> has been blocked by CORS policy: No ‘Access-Control-Allow-Origin’ header is present on the requested resource. 这个错误说明了, 我们是不能通过 ajax 的方式从 <code>http://127.0.0.1:8080</code> 访问 <code>http://localhost:8888/</code> 的.</p><p>既然不能通过 ajax 实现跨域的访问, 同时 mdn 又说 script 标签不受同源策略的限制. 那么, 我们尝试一下用 script 标签引入 <code>http://localhost:8888/</code> 试试?</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173403.png" alt="20240627173403"></p><p>此时的<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/d7ae69f656b1476a25057614264c411f7de13da4">代码</a>, 网络请求没有问题. 知识报了 js 文件不合法的问题. 如果我们把接口返回的数据调整为规范的 js 是不是, 嗯哼???</p><p>干起, 修改后端代码, 返回的内容由 <code>hello world</code> 改为 <code>console.log(&#39;hello world&#39;)</code>, 修改后的<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/bb5b1d2c6a1f3756c4fc7d5dda04e9bc6b30310e">代码</a>(修改完后端代码以后切记重启服务哈 ^_^)</p><p>不得了, 不得了, 返回的结果不紧没有报错, 甚至可以执行. 我们从后端返回的 <code>hellow world</code> 成功的答应到了控制台了.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173414.png" alt="20240627173414"></p><p>试想一下, 如果我们通过 js 文件里定义一个变量用于存放后端返回给前端的数据, 前端插入一个 script 标签, 把后端返回的变量定义执行一把. 那样定义的变量岂不是就可以在全局可以获取到后端定义的变量了. 赶紧试一把 😄</p><p>首先修改后端代码, 只需要调整一行.(修改完后端代码以后切记重启服务哈 ^_^)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.<span class="title function_">end</span>(<span class="string">&quot;var aaaa = &#123;name: &#x27;quanquan&#x27;, friend: &#x27;guiling&#x27;&#125;&quot;</span>);</span><br></pre></td></tr></table></figure><p>其次调整前端代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 第一次因为还没有引入外部 js 所以打印 undefined</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">aaaa</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 1 秒后, 外部 js 加载完成, 能打印出后端返回的变量定义</span></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">aaaa</span>)&#125;, <span class="number">1e3</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:8888/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当前<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/5bdc0dd023f4676a8d6eebb87af73e087661d830">代码</a>, 通过这种方式, 我们能够成功的获取到后端返回的数据. 但是, 接口这个东西时快时慢. 写个定时器轮询? 有点不够 666, 肿么办?</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173430.png" alt="20240627173430"></p><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 思考 5 分钟 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><p><img src="https://handle-note-img.niubishanshan.top/20240627173437.png" alt="20240627173437"></p><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 5 分钟已过 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><p>既然, 写在 script 标签上的内容是可以直接执行的. 那么, 如果我们把变量的定义改写成一个函数的执行可不可以呢 ^_^, 试试?</p><p>后端(修改完后端代码以后切记重启服务哈 ^_^)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.<span class="title function_">end</span>(<span class="string">&quot;aaaa(&#123;name: &#x27;quanquan&#x27;, friend: &#x27;guiling&#x27;&#125;)&quot;</span>);</span><br></pre></td></tr></table></figure><p>前端</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 由于后端返回的内容即将调用函数 aaaa, 那我们就预先定义一个呗, 这东西就叫回调函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">aaaa</span>(<span class="params">param</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;后端返回的参数是: &#x27;</span>, param)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:8888/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>结果<br><img src="https://handle-note-img.niubishanshan.top/20240627173450.png" alt="20240627173450"></p><p>此时<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/a2e0ba9ca2edcabf03ca549fd018d85c96fa0c64">代码</a>, 目前为止, 我们已经彻底解决了跨域的问题. 很靠谱有木有? 当然木有. 这个玩意儿只是说明了 jsonp 的原理, 并没有实用性. 下一步, 我们做一点封装. 让我们的代码更健壮 💪🏻</p><p>最后, 修改一把代码</p><p>前端</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 Jsonp 类</span></span><br><span class="line"><span class="comment">// 初始化时传入两个参数, url 是接口的url</span></span><br><span class="line"><span class="comment">// cb 是对于接口返回的参数的处理</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Jsonp</span>(<span class="params">url, cb</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">callbackName</span> = <span class="string">&#x27;jsonp_&#x27;</span> + <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> = cb</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">url</span> = url</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化方法 用于拼接 url</span></span><br><span class="line"><span class="title class_">Jsonp</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">init</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(~<span class="variable language_">this</span>.<span class="property">url</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;?&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">url</span> = <span class="variable language_">this</span>.<span class="property">url</span> + <span class="string">&#x27;&amp;callback=&#x27;</span> + <span class="variable language_">this</span>.<span class="property">callbackName</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">url</span> = <span class="variable language_">this</span>.<span class="property">url</span> + <span class="string">&#x27;?callback=&#x27;</span> + <span class="variable language_">this</span>.<span class="property">callbackName</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">createCallback</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">createScript</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 script 标签, src 取接口请求的url</span></span><br><span class="line"><span class="title class_">Jsonp</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">createScript</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">    script.<span class="property">src</span> = <span class="variable language_">this</span>.<span class="property">url</span></span><br><span class="line">    script.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">remove</span>()</span><br><span class="line">        <span class="comment">// 删除 window 下定义的无用方法</span></span><br><span class="line">        <span class="keyword">delete</span> <span class="variable language_">window</span>[<span class="variable language_">this</span>.<span class="property">callbackName</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定回调函数</span></span><br><span class="line"><span class="title class_">Jsonp</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">createCallback</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>[<span class="variable language_">this</span>.<span class="property">callbackName</span>] = <span class="variable language_">this</span>.<span class="property">cb</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 jsonp 实例, 并指定回调函数</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Jsonp</span>(<span class="string">&#x27;http://localhost:8888/&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>后端(修改完后端代码以后切记重启服务哈 ^_^)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">// 新引入了 url 模块, 主要用于解析请求参数</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 http 服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取前端请求数据</span></span><br><span class="line">  <span class="keyword">const</span> queryObj = url.<span class="title function_">parse</span>(request.<span class="property">url</span>, <span class="literal">true</span>).<span class="property">query</span>;</span><br><span class="line">  <span class="comment">// 这里把前端传来的 callback 字段作为后端返回的回调函数的函数名称</span></span><br><span class="line">  response.<span class="title function_">end</span>(<span class="string">`<span class="subst">$&#123;queryObj.callback&#125;</span>(&#123;name: &#x27;quanquan&#x27;, friend: &#x27;guiling&#x27;&#125;)`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务, 监听端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动成功, 正在监听: &#x27;</span>, <span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>目前<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/75331e68e664549144cb98c8086aa38d5cc57310">代码</a>, 至此我们已经能够顺利的获取跨域资源了. 👏🏻.</p><p>下集预告: jsonp 是一种传统的跨域解决方案, 关于这种方式的优缺点, 请<a target="_blank" rel="noopener" href="https://www.baidu.com/">度娘</a>, 下一节, 我们一起学习相对比较现代一点的跨域解决方案. <code>CORS</code>, See You</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/blog/" rel="tag"># blog</a></div><div class="post-nav"><div class="post-nav-item"><a href="/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/brew-%E5%AE%89%E8%A3%85%E5%BA%94%E7%94%A8%E5%85%8D%E7%AD%89%E5%BE%85-Updating-Homebrew/" rel="prev" title="brew 安装应用免等待 Updating Homebrew..."><i class="fa fa-chevron-left"></i> brew 安装应用免等待 Updating Homebrew...</a></div><div class="post-nav-item"> <a href="/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/JavaScript/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/JavaScript/package.json%20%E4%B8%AD%E5%BA%93%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7%E7%AC%A6%E5%8F%B7/" rel="next" title="package.json 中库的版本号符号">package.json 中库的版本号符号<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>
  window.addEventListener('tabs:register', function() {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-text">准备工作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AJAX-%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">AJAX 访问接口跨域解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jsonp"><span class="nav-text">jsonp</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="圈圈的圈" src="/images/avatar.png"><p class="site-author-name" itemprop="name">圈圈的圈</p><div class="site-description" itemprop="description">技术学习, 读书笔记, 生活感悟 ~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">142</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://juejin.im/user/5837c2bd61ff4b006ca8d1b2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5837c2bd61ff4b006ca8d1b2" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://github.com/luoquanquan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoquanquan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:luo_quanquan@163.com" title="E-Mail → mailto:luo_quanquan@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17034706号-1</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">圈圈的圈</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/js/theme-next-canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>
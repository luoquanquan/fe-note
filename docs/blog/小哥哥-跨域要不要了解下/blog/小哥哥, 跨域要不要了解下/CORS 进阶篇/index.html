<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("http://note.niubishanshan.top").hostname,root:"/",scheme:"Gemini",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.json",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="预检请求的诞生 在前一篇文章结尾, 我们发现使用 CORS 方式实现跨域, 有时候会发送两个请求 一个 OPTIONS 一个正常请求, 这个 OPTIONS 是个什么鬼呢?  下面贴一段 MDN 的解释"><meta property="og:type" content="article"><meta property="og:title" content="CORS 进阶篇"><meta property="og:url" content="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/CORS%20%E8%BF%9B%E9%98%B6%E7%AF%87/index.html"><meta property="og:site_name" content="圈圈的笔记"><meta property="og:description" content="预检请求的诞生 在前一篇文章结尾, 我们发现使用 CORS 方式实现跨域, 有时候会发送两个请求 一个 OPTIONS 一个正常请求, 这个 OPTIONS 是个什么鬼呢?  下面贴一段 MDN 的解释"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221603.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221641.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221652.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221714.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221722.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221736.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221745.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221755.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221808.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221835.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221845.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221857.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221905.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221917.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627221926.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/cross-domain3.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222109.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222116.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222125.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627222134.png"><meta property="article:published_time" content="2018-12-08T14:15:15.000Z"><meta property="article:modified_time" content="2024-06-27T15:04:43.276Z"><meta property="article:author" content="圈圈的圈"><meta property="article:tag" content="blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://handle-note-img.niubishanshan.top/20240627221603.png"><link rel="canonical" href="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/CORS%20%E8%BF%9B%E9%98%B6%E7%AF%87/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>CORS 进阶篇 | 圈圈的笔记</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a target="_blank" rel="noopener" href="https://github.com/luoquanquan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">圈圈的笔记</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">路漫漫其修远兮, 吾将上下而求索</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/CORS%20%E8%BF%9B%E9%98%B6%E7%AF%87/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="圈圈的圈"><meta itemprop="description" content="技术学习, 读书笔记, 生活感悟 ~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="圈圈的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> CORS 进阶篇</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-12-08 22:15:15" itemprop="dateCreated datePublished" datetime="2018-12-08T22:15:15+08:00">2018-12-08</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-27 23:04:43" itemprop="dateModified" datetime="2024-06-27T23:04:43+08:00">2024-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/" itemprop="url" rel="index"><span itemprop="name">blog</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/" itemprop="url" rel="index"><span itemprop="name">小哥哥, 跨域要不要了解下</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="预检请求的诞生"><a href="#预检请求的诞生" class="headerlink" title="预检请求的诞生"></a>预检请求的诞生</h2><blockquote><p>在<a target="_blank" rel="noopener" href="https://juejin.im/post/5c0a55e76fb9a049ef2665ba">前一篇文章</a>结尾, 我们发现使用 CORS 方式实现跨域, 有时候会发送两个请求 <code>一个 OPTIONS 一个正常请求</code>, 这个 OPTIONS 是个什么鬼呢?</p></blockquote><p>下面贴一段 MDN 的解释</p><span id="more"></span><p><img src="https://handle-note-img.niubishanshan.top/20240627221603.png" alt="20240627221603"></p><p>众所周知, 后端 API 设计比较流行的范式就是 restful(到 2018 年 12 月 8 日). 在 restful 中分别用不同的 HTTP METHOD 标识后端的 CURD, 对于使用这些可能会更新后端数据的 HTTP METHOD 发出的跨域请求, 浏览器要首先和服务器商定一下当前的域名是不是有执行对应的 CURD 的权限. 于是这个 OPTIONS 类型的 <code>预检请求</code> 就诞生了. 那么问题来了 <code>可能对服务器数据产生副作用的 HTTP 请求方法</code> 是有那些咧? 不知道么有关系, TIM 队长为我们探探路 😄</p><p><img src="https://handle-note-img.niubishanshan.top/20240627221641.png" alt="20240627221641"></p><h2 id="简单请求-VS-复杂请求"><a href="#简单请求-VS-复杂请求" class="headerlink" title="简单请求 VS 复杂请求"></a>简单请求 VS 复杂请求</h2><p>在 CORS 机制中, 把请求分为了 <code>简单请求</code> 和 <code>复杂请求</code>, 一个 HTTP 请求若想要让自己成为一个简单请求就要满足以下条件:</p><ul><li>首先, 请求方式的限制: 请求方式(method) 只能是 <code>GET POST HEAD</code> 三者中的一个</li><li>其次就是请求头字段的限制: 请求头字段必须包含在以下集合中, 包括: <code>Accept Accept-Language Content-Language Content-Type DPR Downlink Save-Data Viewport-Width Width</code>.</li><li>其次就是请求头值的限制: 当请求头中包含 <code>Content-Type</code> 的时候, 其值必须为 <code>text/plain multipart/form-data application/x-www-form-urlencoded(这个是 form 提交默认的 Content-Type)</code> 三者中的一个.</li></ul><p>综上, 只要前端发出的请求满足以上三个条件, 你发出的请求就是简单请求. 那么什么事复杂请求呢? 答: 只要不是简单请求就是复杂请求. 原本以为很难理清的概念, 居然只有三个条件搞定 ^_^.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627221652.png" alt="20240627221652"></p><p>再告诉大家一个秘密, 所有的简单请求跨域访问都是不会触发预检请求的哟. 那是复杂请求的专利…</p><h2 id="预检请求都干了啥-😳"><a href="#预检请求都干了啥-😳" class="headerlink" title="预检请求都干了啥 😳"></a>预检请求都干了啥 😳</h2><blockquote><p>对于复杂请求发生跨域访问前, 总是要通过预检请求进行鉴权. 那么鉴权的过程到底是啥么样子的呢? 这一步我们一起来研究一下.</p></blockquote><ul><li>首先, 打开<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/11686561e729075da6c5d7d1c64470e08ad790e8">上一节的代码</a></li><li>分别执行 <code>node ./be/cors/index.js</code> <code>live-server ./fe/cors</code> 启动后端服务和前端的 web 容器.</li><li>浏览器自动打开后打开控制台, 切换到 Network tab 并刷新浏览器. 不出意外的话, 看到的是这个样子的<br><img src="https://handle-note-img.niubishanshan.top/20240627221714.png" alt="20240627221714"></li><li>点击一下第一个 localhost 请求并查看详情<br><img src="https://handle-note-img.niubishanshan.top/20240627221722.png" alt="20240627221722"><br>不难发现, 响应头里标注的几个字段, 就是我们的后端项目里边写的几个.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>);</span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Max-Age&#x27;</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure><p>一一对应, 绝非偶然 😄. 那么请求头中标注的两个又是什么意思呢?</p><p>浏览器在接受到我们发送的跨域请求的指令时, 会自动判断我们的请求是否属于跨域请求, 如果是的话便会发出预检请求, 预检请求的请求头信息也是浏览器根据我们的请求信息自动添加的. 示例项目中, 因为我们的请求是 <code>PUT</code> 类型的, 所以在预检请求的时候会添加 <code>Access-Control-Allow-Methods: PUT</code> 来咨询服务器自己是否可以向它发送这种类型的请求. 同理, 由于我们的请求中有自定义请求头 <code>token</code> 所以, 在预检请求中, 浏览器要和服务器做是否可以添加自定义请求头的协商. 只有当浏览器和服务器之间的预检请求协商通过了, 浏览器才会继续发送真正的 <code>AJAX</code> 请求.</p><h2 id="老板说-我不想看到多余的请求"><a href="#老板说-我不想看到多余的请求" class="headerlink" title="老板说, 我不想看到多余的请求"></a>老板说, 我不想看到多余的请求</h2><p>在工作中, 老板往往是不懂技术的. 能看控制台的老板一般是高手了. 面对这种一个 api 发两次请求的情况可能一个程序员笑笑也就过去了, 但是老板就不这么认为了, 一个接口他就要一次请求. 你要把 <code>圈圈的圈</code> 跨域文章推荐给老板, 让小哥哥也了解下? 估计你会被 fire 掉. 那肿么办呢?</p><p><img src="https://handle-note-img.niubishanshan.top/20240627221736.png" alt="20240627221736"></p><p>面对这种情况, 有两种解决方案.</p><ul><li>第一种, 可以和后端小哥哥商量一下. 把接口改成简单请求, 预检请求的问题就迎刃而解了.</li><li>然而, 有时候写好的代码谁都不愿意去改. 后端小哥哥不听话. 这种情况下 <code>Access-Control-Max-Age</code> 就派上用场了. 这个响应头的意思是预检请求的有效期. 在指定时间内再次跨域访问接口, 是不需要预检请求的, 单位是 <code>秒</code>. 如果我们把有效时间写的非常的长, 那么四不四看上去就像删除了预检请求了呢 ^_^.</li><li>附加情况, 你老板不懂技术瞎 J8 指挥. 小爷我不干了. 当然这种处理方案比较不推荐.</li></ul><p>PS: 使用 <code>Access-Control-Max-Age</code> 机制和缓存类似, 所以给老板演示的时候千万不要清理缓存. 不要勾选 Network 下的 <code>disable cache</code>. 不说啦, 都是泪…</p><p><img src="https://handle-note-img.niubishanshan.top/20240627221745.png" alt="20240627221745"></p><h2 id="咱们不能允许所有的人都访问呀"><a href="#咱们不能允许所有的人都访问呀" class="headerlink" title="咱们不能允许所有的人都访问呀"></a>咱们不能允许所有的人都访问呀</h2><p>通过 <code>Access-Control-Allow-Origin</code>, 可以在后端设置可以跨域访问我们的域名列表, <code>*</code> 代表所有的域名都可以跨域访问我们的后端, 这样其实是有隐患的. 为了安全起见, 我们把可以跨域访问的域名限制为我们已知的域名. 老规矩.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627221755.png" alt="20240627221755"></p><p>后端代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改一行代码, 一定要添加协议哟</span></span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>);</span><br></pre></td></tr></table></figure><p>修改以后浏览器访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/">http://127.0.0.1:8080</a></p><p><img src="https://handle-note-img.niubishanshan.top/20240627221808.png" alt="20240627221808"></p><p>如果想要开放多个域名的跨域访问咋办咧?</p><p>如果我们有多个业务域名需要跨域访问同一个服务器, 可以把允许的域名列表保存到一个数组里. 接到请求之后先判断当前请求域名是否在我们允许的域名列表里, 如果在的话直接添加到响应头 <code>Access-Control-Allow-Origin</code> 下.</p><p>后端代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协议名必填, 如果同时存在 http 和 https 就写两条s</span></span><br><span class="line"><span class="keyword">const</span> allowOrigin = [<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>, <span class="string">&#x27;https://www.baidu.com&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 http 服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">headers</span>: &#123; origin &#125; &#125; = request;</span><br><span class="line">  <span class="keyword">if</span> (allowOrigin.<span class="title function_">includes</span>(origin)) &#123;</span><br><span class="line">    response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, origin);</span><br><span class="line">  &#125;</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>);</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Max-Age&#x27;</span>, <span class="number">5</span>);</span><br><span class="line">  response.<span class="title function_">end</span>(<span class="string">&quot;&#123;name: &#x27;quanquan&#x27;, friend: &#x27;guiling&#x27;&#125;&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务, 监听端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动成功, 正在监听: &#x27;</span>, <span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>此时<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/7015daf88efd5eff890f5bcaa40ce15ba1357a1f">代码</a>, 首先访问<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/">http://127.0.0.1:8080</a></p><p><img src="https://handle-note-img.niubishanshan.top/20240627221835.png" alt="20240627221835"></p><p>响应结果成功打印, 没有任何问题.</p><p>其次访问 <a target="_blank" rel="noopener" href="https://www.baidu.com/">https://www.baidu.com</a>, 打开控制台, 执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://localhost:8888&#x27;</span>)</span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    xhr.<span class="property">status</span> === <span class="number">200</span> &amp;&amp; xhr.<span class="property">readyState</span> === <span class="number">4</span> &amp;&amp; <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span><br><span class="line">&#125;</span><br><span class="line">xhr.<span class="title function_">send</span>()</span><br></pre></td></tr></table></figure><p><img src="https://handle-note-img.niubishanshan.top/20240627221845.png" alt="20240627221845"></p><p>没有任何报错, 返回结果成功打印. 成功…</p><h2 id="你的请求怎么没有携带-Cookie"><a href="#你的请求怎么没有携带-Cookie" class="headerlink" title="你的请求怎么没有携带 Cookie"></a>你的请求怎么没有携带 Cookie</h2><p>一般情况下, 前端发出的跨域的 ajax OR <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch">fetch</a> 请求是不会携带 Cookie 的. 但是, 后端小哥哥还要. 咋弄咧? 加上呗.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627221857.png" alt="20240627221857"></p><p>前端代码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 xhr.send 之前添加这一行</span></span><br><span class="line">xhr.<span class="property">withCredentials</span> = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>添加完以后, 刷新浏览器.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627221905.png" alt="20240627221905"></p><p>对于这个报错, 不知道你有没有啥好说的, 反正我是没啥话了…</p><p>后端代码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协议名必填, 如果同时存在 http 和 https 就写两条s</span></span><br><span class="line"><span class="keyword">const</span> allowOrigin = [<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>, <span class="string">&#x27;http://localhost:8080&#x27;</span>, <span class="string">&#x27;https://www.baidu.com&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 http 服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method, <span class="attr">headers</span>: &#123; origin, cookie &#125; &#125; = request;</span><br><span class="line">  <span class="keyword">if</span> (allowOrigin.<span class="title function_">includes</span>(origin)) &#123;</span><br><span class="line">    response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, origin);</span><br><span class="line">  &#125;</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>);</span><br><span class="line">  <span class="comment">// 允许前端请求携带 Cookie</span></span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">&#x27;OPTIONS&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;预检请求&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!cookie) &#123;</span><br><span class="line">    <span class="comment">//  如果不存在 Cookie 就设置 Cookie</span></span><br><span class="line">    response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Set-Cookie&#x27;</span>, <span class="string">&#x27;quanquan=fe&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  response.<span class="title function_">end</span>(<span class="string">&quot;&#123;name: &#x27;quanquan&#x27;, friend: &#x27;guiling&#x27;&#125;&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务, 监听端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动成功, 正在监听: &#x27;</span>, <span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>此时<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/3ebead3f6231df75eef65b25c5c4543b19cf49fb">代码</a>, 再次到浏览器看一下.</p><p>Cookie 中多了一条<br><img src="https://handle-note-img.niubishanshan.top/20240627221917.png" alt="20240627221917"></p><p>请求中携带了 Cookie<br><img src="https://handle-note-img.niubishanshan.top/20240627221926.png" alt="20240627221926"></p><p>通过下边的动图可以看出, 我们前后端 Cookie 传递非常的通畅.</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/cross-domain3.gif" alt="cookie-2134567"></p><h2 id="我在响应头上给你返回了-Token-你取出来放在请求头上"><a href="#我在响应头上给你返回了-Token-你取出来放在请求头上" class="headerlink" title="我在响应头上给你返回了 Token, 你取出来放在请求头上"></a>我在响应头上给你返回了 Token, 你取出来放在请求头上</h2><p>工作中常常遇到后端把一些标识放在响应头上返回给前端的 case, 比如用户登录, 后端返回用户的唯一标识放在响应头上. 需要前端获取, 后续的请求都需要把这个标识放在请求头, 用于验证用户的身份.</p><p>我们首先修改后端代码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 response.end() 前添加这一行</span></span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;quanquan&#x27;</span>);</span><br></pre></td></tr></table></figure><p>修改前端代码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(xhr.<span class="property">readyState</span> === <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span><br><span class="line">    <span class="comment">// 打印响应数据时同时打印所有响应头</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="title function_">getAllResponseHeaders</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改完成后<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/a240adeb8566607174b7b4acffa8ec27149d0f35">代码</a>, 浏览器看一下.</p><p>console.log 打印出了空行<br><img src="https://handle-note-img.niubishanshan.top/20240627222109.png" alt="20240627222109"></p><p>但是在 Network Tab 下后端确实返回了响应头 token 字段. 懵逼了…<br><img src="https://handle-note-img.niubishanshan.top/20240627222116.png" alt="20240627222116"></p><p>原来, <code>Access-Control-</code> 系列还有一个响应头 <code>Access-Control-Expose-Headers</code>, 我们在后端代码 <code>response.end(...)</code> 之前加上 <code>response.setHeader(&#39;Access-Control-Expose-Headers&#39;, &#39;token&#39;);</code>再次会浏览器查看<br><img src="https://handle-note-img.niubishanshan.top/20240627222125.png" alt="20240627222125"></p><p>成功了 😄.</p><h2 id="预检请求不返回内容把"><a href="#预检请求不返回内容把" class="headerlink" title="预检请求不返回内容把"></a>预检请求不返回内容把</h2><p>我们的响应结果本来应该是在正式的请求中才需要返回的, 但是我们看下预检请求的返回详情发现<br><img src="https://handle-note-img.niubishanshan.top/20240627222134.png" alt="20240627222134"></p><p>预检请求只是浏览器层面的解析, 前端代码根本拿不到. 这里的内容仅仅是浪费带宽和用户的流量. 所以我们改造一下.预检请求不再返回内容.</p><p>后端代码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协议名必填, 如果同时存在 http 和 https 就写两条s</span></span><br><span class="line"><span class="keyword">const</span> allowOrigin = [<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>, <span class="string">&#x27;http://localhost:8080&#x27;</span>, <span class="string">&#x27;https://www.baidu.com&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 http 服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method, <span class="attr">headers</span>: &#123; origin, cookie &#125; &#125; = request;</span><br><span class="line">  <span class="keyword">if</span> (allowOrigin.<span class="title function_">includes</span>(origin)) &#123;</span><br><span class="line">    response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, origin);</span><br><span class="line">  &#125;</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>);</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Expose-Headers&#x27;</span>, <span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">  response.<span class="title function_">setHeader</span>(<span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;quanquan&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">&#x27;OPTIONS&#x27;</span>) &#123;</span><br><span class="line">    response.<span class="title function_">writeHead</span>(<span class="number">204</span>);</span><br><span class="line">    response.<span class="title function_">end</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!cookie) &#123;</span><br><span class="line">    response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Set-Cookie&#x27;</span>, <span class="string">&#x27;quanquan=fe&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  response.<span class="title function_">end</span>(<span class="string">&quot;&#123;name: &#x27;quanquan&#x27;, friend: &#x27;guiling&#x27;&#125;&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务, 监听端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动成功, 正在监听: &#x27;</span>, <span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>此时<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/cross-domain/commit/8aae5963cb1afc48014ca355b844be62cc0a6e78">代码</a>, 验证, 就不验证了吧. 好使 😄</p><p>下基预告: 前两种跨域方案就算是讲完了, 不少小伙伴吐槽, jsonp 太老, cors 太麻烦…. 那么下一节我们尝试一下 <code>反向代理</code>, See you</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/blog/" rel="tag"># blog</a></div><div class="post-nav"><div class="post-nav-item"><a href="/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/CORS%20%E5%9F%BA%E7%A1%80%E7%AF%87/" rel="prev" title="CORS 基础篇"><i class="fa fa-chevron-left"></i> CORS 基础篇</a></div><div class="post-nav-item"> <a href="/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20%E8%B7%A8%E5%9F%9F%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/NGINX%20%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" rel="next" title="NGINX 反向代理">NGINX 反向代理<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>
  window.addEventListener('tabs:register', function() {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%84%E6%A3%80%E8%AF%B7%E6%B1%82%E7%9A%84%E8%AF%9E%E7%94%9F"><span class="nav-text">预检请求的诞生</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82-VS-%E5%A4%8D%E6%9D%82%E8%AF%B7%E6%B1%82"><span class="nav-text">简单请求 VS 复杂请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%84%E6%A3%80%E8%AF%B7%E6%B1%82%E9%83%BD%E5%B9%B2%E4%BA%86%E5%95%A5-%F0%9F%98%B3"><span class="nav-text">预检请求都干了啥 😳</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%80%81%E6%9D%BF%E8%AF%B4-%E6%88%91%E4%B8%8D%E6%83%B3%E7%9C%8B%E5%88%B0%E5%A4%9A%E4%BD%99%E7%9A%84%E8%AF%B7%E6%B1%82"><span class="nav-text">老板说, 我不想看到多余的请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%92%B1%E4%BB%AC%E4%B8%8D%E8%83%BD%E5%85%81%E8%AE%B8%E6%89%80%E6%9C%89%E7%9A%84%E4%BA%BA%E9%83%BD%E8%AE%BF%E9%97%AE%E5%91%80"><span class="nav-text">咱们不能允许所有的人都访问呀</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%A0%E7%9A%84%E8%AF%B7%E6%B1%82%E6%80%8E%E4%B9%88%E6%B2%A1%E6%9C%89%E6%90%BA%E5%B8%A6-Cookie"><span class="nav-text">你的请求怎么没有携带 Cookie</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%91%E5%9C%A8%E5%93%8D%E5%BA%94%E5%A4%B4%E4%B8%8A%E7%BB%99%E4%BD%A0%E8%BF%94%E5%9B%9E%E4%BA%86-Token-%E4%BD%A0%E5%8F%96%E5%87%BA%E6%9D%A5%E6%94%BE%E5%9C%A8%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%B8%8A"><span class="nav-text">我在响应头上给你返回了 Token, 你取出来放在请求头上</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%84%E6%A3%80%E8%AF%B7%E6%B1%82%E4%B8%8D%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9%E6%8A%8A"><span class="nav-text">预检请求不返回内容把</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="圈圈的圈" src="/images/avatar.png"><p class="site-author-name" itemprop="name">圈圈的圈</p><div class="site-description" itemprop="description">技术学习, 读书笔记, 生活感悟 ~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">142</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://juejin.im/user/5837c2bd61ff4b006ca8d1b2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5837c2bd61ff4b006ca8d1b2" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://github.com/luoquanquan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoquanquan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:luo_quanquan@163.com" title="E-Mail → mailto:luo_quanquan@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17034706号-1</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">圈圈的圈</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/js/theme-next-canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>
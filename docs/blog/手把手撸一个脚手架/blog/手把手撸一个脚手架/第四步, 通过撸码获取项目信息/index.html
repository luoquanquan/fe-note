<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("http://note.niubishanshan.top").hostname,root:"/",scheme:"Gemini",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.json",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前面的章节中我们已经能够获取到命令行中输入的参数, 也能通过 gayhub 开放 api 中获取到项目模板信息, 这里我们开始把之前的功能连缀起来 ^_^  本节用到的工具较多, list 一哈:  获取命令行指令 commander 命令行交互工具 inquirer.js 命令行显示加载中 ora ajax 封装库 axios"><meta property="og:type" content="article"><meta property="og:title" content="第四步, 通过撸码获取项目信息"><meta property="og:url" content="http://note.niubishanshan.top/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/%E7%AC%AC%E5%9B%9B%E6%AD%A5,%20%E9%80%9A%E8%BF%87%E6%92%B8%E7%A0%81%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E4%BF%A1%E6%81%AF/index.html"><meta property="og:site_name" content="圈圈的笔记"><meta property="og:description" content="前面的章节中我们已经能够获取到命令行中输入的参数, 也能通过 gayhub 开放 api 中获取到项目模板信息, 这里我们开始把之前的功能连缀起来 ^_^  本节用到的工具较多, list 一哈:  获取命令行指令 commander 命令行交互工具 inquirer.js 命令行显示加载中 ora ajax 封装库 axios"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627170014.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627170129.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627170200.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627170216.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627170227.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240627170234.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/cli4.gif"><meta property="article:published_time" content="2018-11-15T08:59:37.000Z"><meta property="article:modified_time" content="2024-06-27T15:04:43.278Z"><meta property="article:author" content="圈圈的圈"><meta property="article:tag" content="blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://handle-note-img.niubishanshan.top/20240627170014.png"><link rel="canonical" href="http://note.niubishanshan.top/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/%E7%AC%AC%E5%9B%9B%E6%AD%A5,%20%E9%80%9A%E8%BF%87%E6%92%B8%E7%A0%81%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E4%BF%A1%E6%81%AF/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>第四步, 通过撸码获取项目信息 | 圈圈的笔记</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a target="_blank" rel="noopener" href="https://github.com/luoquanquan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">圈圈的笔记</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">路漫漫其修远兮, 吾将上下而求索</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://note.niubishanshan.top/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/%E7%AC%AC%E5%9B%9B%E6%AD%A5,%20%E9%80%9A%E8%BF%87%E6%92%B8%E7%A0%81%E8%8E%B7%E5%8F%96%E9%A1%B9%E7%9B%AE%E4%BF%A1%E6%81%AF/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="圈圈的圈"><meta itemprop="description" content="技术学习, 读书笔记, 生活感悟 ~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="圈圈的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 第四步, 通过撸码获取项目信息</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-11-15 16:59:37" itemprop="dateCreated datePublished" datetime="2018-11-15T16:59:37+08:00">2018-11-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-27 23:04:43" itemprop="dateModified" datetime="2024-06-27T23:04:43+08:00">2024-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/" itemprop="url" rel="index"><span itemprop="name">blog</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">手把手撸一个脚手架</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>前面的章节中我们已经能够获取到命令行中输入的参数, 也能通过 gayhub 开放 api 中获取到项目模板信息, 这里我们开始把之前的功能连缀起来 ^_^</p></blockquote><p>本节用到的工具较多, list 一哈:</p><ul><li>获取命令行指令 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/commander">commander</a></li><li>命令行交互工具 <a target="_blank" rel="noopener" href="https://github.com/SBoudrias/Inquirer.js#documentation">inquirer.js</a></li><li>命令行显示加载中 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/ora">ora</a></li><li>ajax 封装库 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/axios">axios</a></li></ul><span id="more"></span><p><img src="https://handle-note-img.niubishanshan.top/20240627170014.png" alt="20240627170014"></p><h2 id="首先展示一下目录结构代码地址"><a href="#首先展示一下目录结构代码地址" class="headerlink" title="首先展示一下目录结构代码地址"></a>首先展示一下目录结构<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/learn-cli/tree/0.0.1">代码地址</a></h2><p><img src="https://handle-note-img.niubishanshan.top/20240627170129.png" alt="20240627170129"></p><h2 id="各个文件介绍"><a href="#各个文件介绍" class="headerlink" title="各个文件介绍"></a>各个文件介绍</h2><p>bin&#x2F;learn.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;../&#x27;</span>);</span><br></pre></td></tr></table></figure><p>仍然作为项目的引导文件, 直接引入项目根目录下的 index.js</p><p>index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;babel-register&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&#x27;@babel/core&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> babelPresetLatestNode = <span class="built_in">require</span>(<span class="string">&#x27;babel-preset-latest-node&#x27;</span>);</span><br><span class="line"></span><br><span class="line">babel.<span class="title function_">transform</span>(<span class="string">&#x27;code();&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">presets</span>: [[babelPresetLatestNode, &#123;</span><br><span class="line">    <span class="attr">target</span>: <span class="string">&#x27;current&#x27;</span>,</span><br><span class="line">  &#125;]],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;babel-polyfill&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./src&#x27;</span>);</span><br></pre></td></tr></table></figure><p>根目录下的 index 作为项目的入口文件, 它的职责主要是兼容 es6, 并导入项目主文件 <code>src/index.js</code></p><p>src&#x2F;index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// colors console.log 文本添加字体颜色, 美观</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;colors&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收命令行参数, 提供基础信息提示功能</span></span><br><span class="line"><span class="keyword">import</span> commander <span class="keyword">from</span> <span class="string">&#x27;commander&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 内部模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; existsSync &#125; <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; version &#125; <span class="keyword">from</span> <span class="string">&#x27;../package.json&#x27;</span>;</span><br><span class="line"></span><br><span class="line">commander.<span class="title function_">version</span>(version)</span><br><span class="line">  .<span class="title function_">parse</span>(process.<span class="property">argv</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取命令行中传入的第一个参数</span></span><br><span class="line"><span class="keyword">const</span> [todo = <span class="string">&#x27;&#x27;</span>] = commander.<span class="property">args</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断如果 command 目录下是否存在用户输入的命令对应的文件</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">existsSync</span>(<span class="title function_">resolve</span>(__dirname, <span class="string">`command/<span class="subst">$&#123;todo&#125;</span>.js`</span>))) &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">`./command/<span class="subst">$&#123;todo&#125;</span>.js`</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">    <span class="string">`</span></span><br><span class="line"><span class="string">      你输入了未知指令, 小哥哥我已经受不了挂了...</span></span><br><span class="line"><span class="string">    `</span>.<span class="property">red</span>,</span><br><span class="line">  );</span><br><span class="line">  process.<span class="title function_">exit</span>(-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个是项目的主文件, 也是整个程序的<strong>总控</strong>. 正如注释, 执行命令前, 从这里检测我们的命令目录下是否已经存在了用户请求的命令, 避免了用户误操作程序报错的风险.</p><p>command&#x2F;download.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 命令管理</span></span><br><span class="line"><span class="keyword">import</span> commander <span class="keyword">from</span> <span class="string">&#x27;commander&#x27;</span>;</span><br><span class="line"><span class="comment">// 命令行交互工具</span></span><br><span class="line"><span class="keyword">import</span> inquirer <span class="keyword">from</span> <span class="string">&#x27;inquirer&#x27;</span>;</span><br><span class="line"><span class="comment">// 命令行中显示加载中</span></span><br><span class="line"><span class="keyword">import</span> ora <span class="keyword">from</span> <span class="string">&#x27;ora&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Git</span> <span class="keyword">from</span> <span class="string">&#x27;../tools/git&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Download</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">git</span> = <span class="keyword">new</span> <span class="title class_">Git</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">commander</span> = commander;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">inquirer</span> = inquirer;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">getProList</span> = <span class="title function_">ora</span>(<span class="string">&#x27;获取项目列表...&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">getTagList</span> = <span class="title function_">ora</span>(<span class="string">&#x27;获取项目版本...&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">downLoad</span> = <span class="title function_">ora</span>(<span class="string">&#x27;正在加速为您下载代码...&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">commander</span></span><br><span class="line">      .<span class="title function_">command</span>(<span class="string">&#x27;download&#x27;</span>)</span><br><span class="line">      .<span class="title function_">description</span>(<span class="string">&#x27;从远程下载代码到本地...&#x27;</span>)</span><br><span class="line">      .<span class="title function_">action</span>(<span class="function">() =&gt;</span> &#123; <span class="variable language_">this</span>.<span class="title function_">download</span>(); &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">commander</span>.<span class="title function_">parse</span>(process.<span class="property">argv</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">download</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> getProListLoad;</span><br><span class="line">    <span class="keyword">let</span> getTagListLoad;</span><br><span class="line">    <span class="keyword">let</span> repos;</span><br><span class="line">    <span class="keyword">let</span> version;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      getProListLoad = <span class="variable language_">this</span>.<span class="property">getProList</span>.<span class="title function_">start</span>();</span><br><span class="line">      repos = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">git</span>.<span class="title function_">getProjectList</span>();</span><br><span class="line">      getProListLoad.<span class="title function_">succeed</span>(<span class="string">&#x27;获取项目列表成功&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">      getProListLoad.<span class="title function_">fail</span>(<span class="string">&#x27;获取项目列表失败...&#x27;</span>);</span><br><span class="line">      process.<span class="title function_">exit</span>(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (repos.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\n可以开发的项目数为 0, 肯定是配置错啦~~\n&#x27;</span>.<span class="property">red</span>);</span><br><span class="line">      process.<span class="title function_">exit</span>(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> choices = repos.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; name &#125;</span>) =&gt;</span> name);</span><br><span class="line">    <span class="keyword">const</span> questions = [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;repo&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;请选择你想要开发的项目类型&#x27;</span>,</span><br><span class="line">        choices,</span><br><span class="line">      &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">const</span> &#123; repo &#125; = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">inquirer</span>.<span class="title function_">prompt</span>(questions);</span><br><span class="line">    <span class="comment">// 获取项目的版本, 这里默认选择确定项目的最近一个版本</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      getTagListLoad = <span class="variable language_">this</span>.<span class="property">getTagList</span>.<span class="title function_">start</span>();</span><br><span class="line">      [&#123; <span class="attr">name</span>: version &#125;] = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">git</span>.<span class="title function_">getProjectVersions</span>(repo);</span><br><span class="line">      getTagListLoad.<span class="title function_">succeed</span>(<span class="string">&#x27;获取项目版本成功&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">      getTagListLoad.<span class="title function_">fail</span>(<span class="string">&#x27;获取项目版本失败...&#x27;</span>);</span><br><span class="line">      process.<span class="title function_">exit</span>(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`您选择的项目是<span class="subst">$&#123;repo&#125;</span>, 即将下载版本<span class="subst">$&#123;version&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> D = <span class="keyword">new</span> <span class="title class_">Download</span>();</span><br><span class="line">D.<span class="title function_">run</span>();</span><br></pre></td></tr></table></figure><p>command 目录下存放的是我们整个项目中所有的命令文件, 不同的命令对应不同的文件, 体现了单一职责的设计. download 命令用到了我们上一节中提到的两个接口(即获取项目列表和获取版本号列表)有疑问的同学请回头参考系列文章第三步 ^_^.</p><p>tools&#x2F;git.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;./request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; orgName &#125; <span class="keyword">from</span> <span class="string">&#x27;../../config&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Git</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">orgName</span> = orgName;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getProjectList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">`/orgs/<span class="subst">$&#123;<span class="variable language_">this</span>.orgName&#125;</span>/repos`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getProjectVersions</span>(<span class="params">repo</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">`/repos/<span class="subst">$&#123;<span class="variable language_">this</span>.orgName&#125;</span>/<span class="subst">$&#123;repo&#125;</span>/tags`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getProjectUrl</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">downloadProject</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Git</span>;</span><br></pre></td></tr></table></figure><p>此文件是 git 相关的操作的文件, 由于脚手架的核心功能就是获取项目的 github 地址, 并下载, 所以我的 Git 类规划了以上几个功能, <code>获取项目列表 获取项目版本号列表 获取项目地址 下载项目</code>, 虽然后两个功能在这一节还用不到, 我也先留下了代码桩</p><p>tools&#x2F;request.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; baseURL &#125; <span class="keyword">from</span> <span class="string">&#x27;../../config&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  baseURL,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">1e4</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a request interceptor</span></span><br><span class="line">instance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> config,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a response interceptor</span></span><br><span class="line">instance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="property">data</span>,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> instance;</span><br></pre></td></tr></table></figure><p>这个文件仅仅是对 axios 做了一层简单的封装, 封装的手法我还不是掌握的很好, 如果有精通的小伙伴欢迎评论区赐教.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627170200.png" alt="20240627170200"></p><p>config&#x2F;index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// github 接口基础地址</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> baseURL = <span class="string">&#x27;https://api.github.com&#x27;</span>;</span><br><span class="line"><span class="comment">// organization 名称</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> orgName = <span class="string">&#x27;learn-cli-organization&#x27;</span>;</span><br></pre></td></tr></table></figure><p>作为整个项目的配置文件, 承担了保存项目运行过程中需要的配置信息的功能.</p><p>介绍完几个文件, 感到如释重负. 如果有手懒的小伙伴, 可以直接 github clone <a target="_blank" rel="noopener" href="https://github.com/luoquanquan/learn-cli/tree/0.0.1">本阶段代码</a>按照第一步的方法配置即可</p><p>ps: <code>git clone https://github.com/luoquanquan/learn-cli.git</code><br>ps: <code>git checkout 0.0.1</code><br>ps: 完成后要执行 <code>npm i</code> 和 <code>npm link</code> 的哟 ^_^</p><h2 id="验证代码"><a href="#验证代码" class="headerlink" title="验证代码"></a>验证代码</h2><p>终于到了验证的环节. 小伙伴们, 自己写完或者 git clone 完代码以后可以打开终端啦, 484 有点小小的鸡冻 ^_^</p><p><img src="https://handle-note-img.niubishanshan.top/20240627170216.png" alt="20240627170216"></p><p>输入 <code>learn download</code></p><p><img src="https://handle-note-img.niubishanshan.top/20240627170227.png" alt="20240627170227"></p><p>出现上图所示的项目名称和版本号, 说明我们已经通过代码获取 git 项目信息成功啦.</p><p><img src="https://handle-note-img.niubishanshan.top/20240627170234.png" alt="20240627170234"></p><p>下集预告: 到现在, 我们已经能够从 github 获取到项目的名称和版本号, 下一步会尝试把项目 download 到本地用到了工具 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/download-git-repo">download-git-repo</a>, 热爱动手的小伙伴已经可以开始着手啦, 说不定下一步就是你来写喲 😄</p><h1 id="x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-更新-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D"><a href="#x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-更新-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 更新 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;"></a>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 更新 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</h1><p>由于 github 开放 api 访问次数的限制(未授权每小时只有 60 次), 所以我们不得不加上授权.其实就是申请一个 github 授权 token 写到代码里. 申请 token 的步骤在这里<br><img src="https://handle-note-img.niubishanshan.top/gifs/cli4.gif" alt="get-token"></p><p>最后贴上添加 token 以后的一次<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/learn-cli/commit/a74901dc373373d5d7ff425ddb66203cb689cd28">提交记录</a></p><p>为什么要把 token 先改成乱码在反转回来呢? 因为脚手架代码要上传到 github, 上传时候如果你的代码中存在 github token 明文的话, 该 token 就会被删除. (不说了都是泪….)</p><p>最终的<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/learn-cli/tree/0.0.5">代码</a></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/blog/" rel="tag"># blog</a></div><div class="post-nav"><div class="post-nav-item"><a href="/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/%E7%AC%AC%E4%B8%89%E6%AD%A5,%20%E8%8E%B7%E5%8F%96%20github%20%E9%A1%B9%E7%9B%AE%E4%BF%A1%E6%81%AF/" rel="prev" title="第三步, 获取 github 项目信息"><i class="fa fa-chevron-left"></i> 第三步, 获取 github 项目信息</a></div><div class="post-nav-item"> <a href="/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/blog/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%92%B8%E4%B8%80%E4%B8%AA%E8%84%9A%E6%89%8B%E6%9E%B6/%E7%AC%AC%E4%BA%94%E6%AD%A5,%20%E6%92%B8%E5%AE%8C%E6%94%B6%E5%B7%A5/" rel="next" title="第五步, 撸完收工">第五步, 撸完收工<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>
  window.addEventListener('tabs:register', function() {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A6%96%E5%85%88%E5%B1%95%E7%A4%BA%E4%B8%80%E4%B8%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E4%BB%A3%E7%A0%81%E5%9C%B0%E5%9D%80"><span class="nav-text">首先展示一下目录结构代码地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%84%E4%B8%AA%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="nav-text">各个文件介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E4%BB%A3%E7%A0%81"><span class="nav-text">验证代码</span></a></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-%E6%9B%B4%E6%96%B0-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D"><span class="nav-text">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 更新 &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span></a></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="圈圈的圈" src="/images/avatar.png"><p class="site-author-name" itemprop="name">圈圈的圈</p><div class="site-description" itemprop="description">技术学习, 读书笔记, 生活感悟 ~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">142</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://juejin.im/user/5837c2bd61ff4b006ca8d1b2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5837c2bd61ff4b006ca8d1b2" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://github.com/luoquanquan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoquanquan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:luo_quanquan@163.com" title="E-Mail → mailto:luo_quanquan@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17034706号-1</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">圈圈的圈</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/js/theme-next-canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>
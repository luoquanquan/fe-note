<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("http://note.niubishanshan.top").hostname,root:"/",scheme:"Gemini",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.json",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="作为实用篇本篇将会添加 react-router redux 加入路由畅游皇冠赌场客户端渲染配置 react-router来到皇冠赌场的大家那肯定是丈二的和尚, 摸不着头脑呀. 那么路由就应运而生了, 关于路由的原理建议大家看看这篇文章."><meta property="og:type" content="article"><meta property="og:title" content="小哥哥, React SSR 要不要了解下-实用篇"><meta property="og:url" content="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-React-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20React%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/%E5%B0%8F%E5%93%A5%E5%93%A5,%20React%20SSR%20%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B-%E5%AE%9E%E7%94%A8%E7%AF%87/index.html"><meta property="og:site_name" content="圈圈的笔记"><meta property="og:description" content="作为实用篇本篇将会添加 react-router redux 加入路由畅游皇冠赌场客户端渲染配置 react-router来到皇冠赌场的大家那肯定是丈二的和尚, 摸不着头脑呀. 那么路由就应运而生了, 关于路由的原理建议大家看看这篇文章."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625230232.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625230251.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625230304.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625230335.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/router.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/router2.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625230955.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231005.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231020.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/router3.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231143.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231155.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231206.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/ssr.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/jump.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231402.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231420.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231433.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/ssr1.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231536.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/ssr2.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231641.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231656.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231708.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/ssr3.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231749.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/ssr4.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625231843.png"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/ssr4-1.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/gifs/ssr5.gif"><meta property="og:image" content="https://handle-note-img.niubishanshan.top/20240625232053.png"><meta property="article:published_time" content="2019-08-16T14:59:29.000Z"><meta property="article:modified_time" content="2024-06-27T15:04:43.275Z"><meta property="article:author" content="圈圈的圈"><meta property="article:tag" content="blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://handle-note-img.niubishanshan.top/20240625230232.png"><link rel="canonical" href="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-React-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20React%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/%E5%B0%8F%E5%93%A5%E5%93%A5,%20React%20SSR%20%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B-%E5%AE%9E%E7%94%A8%E7%AF%87/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>小哥哥, React SSR 要不要了解下-实用篇 | 圈圈的笔记</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a target="_blank" rel="noopener" href="https://github.com/luoquanquan" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">圈圈的笔记</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">路漫漫其修远兮, 吾将上下而求索</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://note.niubishanshan.top/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-React-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20React%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/%E5%B0%8F%E5%93%A5%E5%93%A5,%20React%20SSR%20%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B-%E5%AE%9E%E7%94%A8%E7%AF%87/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="圈圈的圈"><meta itemprop="description" content="技术学习, 读书笔记, 生活感悟 ~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="圈圈的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 小哥哥, React SSR 要不要了解下-实用篇</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-16 22:59:29" itemprop="dateCreated datePublished" datetime="2019-08-16T22:59:29+08:00">2019-08-16</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-27 23:04:43" itemprop="dateModified" datetime="2024-06-27T23:04:43+08:00">2024-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/" itemprop="url" rel="index"><span itemprop="name">blog</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-React-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/" itemprop="url" rel="index"><span itemprop="name">小哥哥, React 服务端渲染要不要了解下</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>作为实用篇本篇将会添加 react-router redux</p><h2 id="加入路由畅游皇冠赌场"><a href="#加入路由畅游皇冠赌场" class="headerlink" title="加入路由畅游皇冠赌场"></a>加入路由畅游皇冠赌场</h2><h3 id="客户端渲染配置-react-router"><a href="#客户端渲染配置-react-router" class="headerlink" title="客户端渲染配置 react-router"></a>客户端渲染配置 react-router</h3><p>来到皇冠赌场的大家那肯定是丈二的和尚, 摸不着头脑呀. 那么路由就应运而生了, 关于路由的原理建议大家看看<a target="_blank" rel="noopener" href="https://juejin.im/post/5d2d19ccf265da1b7f29b05f">这篇文章</a>.</p><span id="more"></span><p><img src="https://handle-note-img.niubishanshan.top/20240625230232.png" alt="20240625230232"></p><p>如果你看了还回来了, 那说明还是我们澳门 XXXX 更加的有意思 😹.</p><p>谈到赌场无非就是这老四样, 抓牌, 看牌, 洗牌, 码牌~</p><p><img src="https://handle-note-img.niubishanshan.top/20240625230251.png" alt="20240625230251"></p><p>那么我们就开始, 创建几个页面. 页面的代码结构如下图所示.</p><p><img src="https://handle-note-img.niubishanshan.top/20240625230304.png" alt="20240625230304"></p><p>为了便于各个 level 的小伙伴理解, 这里无耻的运用了拼音命名法. 代码改动在<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/8aef4f3714d83f5341c64a1956498e891356e5ac">这里</a></p><p>其次, 安装 react-router-dom 依赖, 并修改 App.jsx 和 client.js 文件, diff 在<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/9b0fb5352770139622cff9d8e04b027016ef6435">这里</a></p><p>修改后的 App.jsx 文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="comment">// 从 react-router-dom 引入基础组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NavLink</span>, <span class="title class_">Switch</span>, <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入皇冠赌场的页面</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;./Home.jsx&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Zhuapai</span> <span class="keyword">from</span> <span class="string">&#x27;./Zhuapai.jsx&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Kanpai</span> <span class="keyword">from</span> <span class="string">&#x27;./Kanpai.jsx&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Xipai</span> <span class="keyword">from</span> <span class="string">&#x27;./Xipai.jsx&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Mapai</span> <span class="keyword">from</span> <span class="string">&#x27;./Mapai.jsx&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;ssr-show&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎来到澳门皇冠赌场<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&quot;/Zhuapai&quot;</span>&gt;</span>抓牌<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&quot;/Kanpai&quot;</span>&gt;</span>看牌<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&quot;/Xipai&quot;</span>&gt;</span>洗牌<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&quot;/Mapai&quot;</span>&gt;</span>码牌<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/Zhuapai&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Zhuapai&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/Kanpai&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Kanpai&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/Xipai&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Xipai&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/Mapai&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Mapai&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改后的 client.js 为</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="comment">// 从 react-router-dom 里边导入 BrowserRouter 组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./components/App.jsx&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 包装一下 App 组件</span></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>目前为止, 路由就算是配完了. 执行 <code>npm run build:client</code> 后, 用浏览器打开 index.html 文件.</p><p><img src="https://handle-note-img.niubishanshan.top/20240625230335.png" alt="20240625230335"></p><p>成功就在眼前, 但是难免有一点小小的障碍~</p><p>这个报错的大致意思就是, 本地的文件不能用 react-router, 那么我们只能把它放到一个服务器上了. 还是我们的老伙伴 — <code>live-server</code> 直接执行 <code>live-server ./dist</code></p><p>浏览器打开 <code>localhost:8080</code></p><p><img src="https://handle-note-img.niubishanshan.top/gifs/router.gif" alt="react-router-err"></p><p>我们不难发现, 点击链接的时候浏览器地址栏有变化, 但是我们并不能体验到从发牌到码牌的一条龙”服务”…</p><p>看了下 react-router 的 <a target="_blank" rel="noopener" href="https://reacttraining.com/react-router/web/api/Route/exact-bool">官方文档</a> 原来我们没有指定路径匹配必须得精准匹配. 那么我们加上 <code>exact</code> 属性试试咧~</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/router2.gif" alt="react-router"></p><p>此时的代码 <a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/653639940d9d5ecf66f668374727f8f9ae9de00e">diff</a></p><p>到目前为止, 我我们已经可以畅游澳门皇冠赌场了, 抓牌看牌洗牌码牌样样精通~</p><h3 id="配置服务端渲染的-react-router"><a href="#配置服务端渲染的-react-router" class="headerlink" title="配置服务端渲染的 react-router"></a>配置服务端渲染的 react-router</h3><p>轻松搞定了客户端渲染的 react-router, 服务端渲染的话那就更加的简单了.</p><ul><li>首先肯定是要引入 react-router-dom 依赖的(ps: ssr 需要导入的是 StaticRouter)<br><img src="https://handle-note-img.niubishanshan.top/20240625230955.png" alt="20240625230955"></li><li>创建路由上线文对象, 并获取到当前用户访问的路径 path<br><img src="https://handle-note-img.niubishanshan.top/20240625231005.png" alt="20240625231005"></li><li>最后, 利用第一步导入的 StaticRouter 组件包裹一下之前生成的服务端渲染组件<br><img src="https://handle-note-img.niubishanshan.top/20240625231020.png" alt="20240625231020"></li></ul><p>代码<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/51181e64b06d5eeaae8920f4e09392c6d2fef241">diff</a></p><p>最后的最后, 我们执行一下 <code>node index.js</code>, 浏览器打开 <code>localhost:9999</code></p><p><img src="https://handle-note-img.niubishanshan.top/gifs/router3.gif" alt="react-router-ssr"></p><p>通过 gif 我们能发现, 我们的服务端渲染是货真价实的服务端渲染了. 查看源代码的 html 字符串没有任何的问题了.(如果有样式该咋办呢 🤔)</p><p>细心的同学可能发现了, 我们每次点击链接的时候页面都会整体刷新. 这里就又到了那个经典的面试题<a target="_blank" rel="noopener" href="https://juejin.im/post/5a0ea4ec6fb9a0450407725c">前端：你要懂的单页面应用和多页面应用</a>, 我们的目的很简单, 只是需要 ssr 实现首屏的渲染, 之后就由客户端接管, 这样就结合了两者的优点. 需求是有了, 怎么实现咧~</p><h1 id="x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D"><a href="#x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;"></a>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</h1><p><img src="https://handle-note-img.niubishanshan.top/20240625231143.png" alt="20240625231143"></p><h1 id="x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-1"><a href="#x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-1" class="headerlink" title="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;"></a>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</h1><p>聪明的同学已经猜到, 只要我们我们在服务端渲染的页面中也引入客户端渲染生成的 <code>bundle.js</code> 文件是不是就 OK 了呢.那我们就试试咯</p><p><img src="https://handle-note-img.niubishanshan.top/20240625231155.png" alt="20240625231155"></p><p>修改 <code>server.js</code> 引入 <code>koa-static</code> 用于托管静态文件, 文件整体 <a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/eef7ac6dbda66ac1ac4236dde5453d80994065e0">diff</a> 如下:</p><p><img src="https://handle-note-img.niubishanshan.top/20240625231206.png" alt="20240625231206"></p><p>废话少扯, 继续 <code>node index.js</code>, 浏览器打开 <code>localhost:9999</code> 搞起~</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/ssr.gif" alt="react-router-dont-reload"></p><p>服务端渲染的路由配置, 这就完成了~</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/jump.gif" alt="sahua"></p><h2 id="配置-redux-带上身份畅玩澳门皇冠"><a href="#配置-redux-带上身份畅玩澳门皇冠" class="headerlink" title="配置 redux, 带上身份畅玩澳门皇冠"></a>配置 redux, 带上身份畅玩澳门皇冠</h2><h3 id="客户端渲染引入-redux"><a href="#客户端渲染引入-redux" class="headerlink" title="客户端渲染引入 redux"></a>客户端渲染引入 redux</h3><p>由于配置 redux 不是我们的重点, 所以这里就不多说了, 简单配置一个 redux 开发环境. 代码 <a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/7f1cb6d181cec0e9cc6903115b8fabadbfd41686">diff</a></p><p>有疑问的问题, 评论区见~</p><p><img src="https://handle-note-img.niubishanshan.top/20240625231402.png" alt="20240625231402"></p><h3 id="ssr-引入-redux"><a href="#ssr-引入-redux" class="headerlink" title="ssr 引入 redux"></a>ssr 引入 redux</h3><p>修改 server.js 文件如下:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Koa</span> <span class="keyword">from</span> <span class="string">&#x27;koa&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> <span class="keyword">from</span> <span class="string">&#x27;koa-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; renderToString &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/server&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">StaticRouter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> serve <span class="keyword">from</span> <span class="string">&#x27;koa-static&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 像客户端渲染一样导入 Provider 组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./components/App.jsx&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> createStore, &#123; init &#125; <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> conf = &#123;</span><br><span class="line">  <span class="attr">PORT</span>: <span class="number">9999</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">generateHtmlStr</span> = reactDom =&gt; <span class="string">`</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Document&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;div id=&quot;app&quot;&gt;<span class="subst">$&#123;reactDom&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;script src=&quot;/dist/bundle.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;*&#x27;</span>, <span class="function">(<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> context = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> &#123; url &#125; = ctx.<span class="property">req</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化一个 store</span></span><br><span class="line">  <span class="keyword">const</span> store = <span class="title function_">createStore</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 手动触发一下 init</span></span><br><span class="line">  store.<span class="title function_">dispatch</span>(<span class="title function_">init</span>());</span><br><span class="line">  <span class="comment">// 首先把 React 组件变成一个字符串</span></span><br><span class="line">  <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">  <span class="keyword">const</span> rNode = <span class="title function_">renderToString</span>(</span><br><span class="line">    <span class="comment">// 把刚刚创建的 store 作为属性传给 Provider 组件</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">StaticRouter</span> <span class="attr">location</span>=<span class="string">&#123;url&#125;</span> <span class="attr">context</span>=<span class="string">&#123;context&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">StaticRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// 然后替换 template 里边的内容</span></span><br><span class="line">  <span class="keyword">const</span> domString = <span class="title function_">generateHtmlStr</span>(rNode);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 最后返回 html 字符串</span></span><br><span class="line">  ctx.<span class="property">body</span> = domString;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">serve</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../&#x27;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(router.<span class="title function_">routes</span>(), router.<span class="title function_">allowedMethods</span>());</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(conf.<span class="property">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`The Server is listening on <span class="subst">$&#123;conf.PORT&#125;</span> now, enjoy`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>代码 <a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/edf5555ca4e0ffd32877b1fcf6415e4008b24840">diff</a> 如下:<br><img src="https://handle-note-img.niubishanshan.top/20240625231420.png" alt="20240625231420"></p><p>还是那一套, 先 <code>node index.js</code> 再浏览器打开 <code>localhost:9999</code>~</p><p><img src="https://handle-note-img.niubishanshan.top/20240625231433.png" alt="20240625231433"></p><p>浏览器执行结果如下图:<br><img src="https://handle-note-img.niubishanshan.top/gifs/ssr1.gif" alt="redux-ssr"></p><p>细心的同学不难发现, 这个图片中抓牌的入口总是会闪动一下, 理论上讲我们执行了 store.dispatch(init()); 证明了用户是已经登录的用户, 所以应该是可以抓牌的才对. 这是问啥呢???</p><p><img src="https://handle-note-img.niubishanshan.top/20240625231536.png" alt="20240625231536"></p><p>其实原因很简单, 我们的项目在首屏渲染完成以后就有客户端渲染接管了, 所以我们应该在客户端接管的时候把之前服务端渲染的数据保留下来. 怎么搞呢?</p><ul><li>首先, 获取首屏情况下的状态</li><li>其次, 升级 server.js 文件, generateHtmlStr 中添加一个参数, 表示当前的状态</li><li>再次, 更新 html 模板, 在 window 下创建一个 REDUX_DATA 属性, 用于放置服务端渲染时首屏的全局状态</li><li>最后, 升级客户端相关的代码, 在 createStore 的时候把 REDUX_DATA 作为参数传入. 也正因此, 定义 REDUX_DATA 要放在引入 <code>bundle.js</code> 的上方.</li></ul><p>这就完了, 通过下边的 gif 可以看出, 状态很好的保存下来了~</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/ssr2.gif" alt="redux-ssr-goog"></p><p>到了这里, 可能有同学会问, 我们来到皇冠赌场, 全局状态肯定会灰常的多, 不应该只有一个登陆状态. 鉴于此, 我们扩充一下全局状态. 添加一个音乐列表. 一遍欢歌一遍看牌~</p><p>下来我们在看牌页面添加一个音乐列表, 我们听着音乐看着牌, 要是再吃着火锅那简直就是人生巅峰了.</p><p><img src="https://handle-note-img.niubishanshan.top/20240625231641.png" alt="20240625231641"></p><h3 id="在-store-中获取异步数据"><a href="#在-store-中获取异步数据" class="headerlink" title="在 store 中获取异步数据"></a>在 store 中获取异步数据</h3><ul><li>首先, 我们创建一个 mock.js, 主要就是访问异步接口获取歌曲列表<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; <span class="title function_">axios</span>(<span class="string">&#x27;https://music.niubishanshan.top/api/v2/music/toplist&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> data);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 mock.js 中我们引用了高端的 ajax 请求库 axios. 那么就不得不 npm i axios -S 啦</span></span><br></pre></td></tr></table></figure></li><li>其次, 升级 store.js 添加歌曲相关的 actions 和 reducer.<br><img src="https://handle-note-img.niubishanshan.top/20240625231656.png" alt="20240625231656"></li><li>由于我们有之前的单 reducer 升级成了两个 reducer, 此时要同步升级之前连接过 redux 的组件 <code>Header Home Zhuapai</code></li><li>最后, 在看牌页面, 我们引入音乐. party Time<br><img src="https://handle-note-img.niubishanshan.top/20240625231708.png" alt="20240625231708"></li></ul><p>到目前为止, 代码是 <a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commits/v3.0.0">这样</a> 的.</p><p>废话少说…</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/ssr3.gif" alt="error-kanpai"></p><p><img src="https://handle-note-img.niubishanshan.top/20240625231749.png" alt="20240625231749"></p><p>卧槽, 居然不好使…</p><p>仔细看一下, 原来是 action 里边不能包含异步. 这个简单. 我们<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/b9e91ed8eaf9d0a859bbf2c9df66c4c25dca966c">升级</a>一下.</p><p>然后…</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/ssr4.gif" alt="ok-kanpai"></p><h3 id="服务端渲染支持首屏展示初始异步数据"><a href="#服务端渲染支持首屏展示初始异步数据" class="headerlink" title="服务端渲染支持首屏展示初始异步数据"></a>服务端渲染支持首屏展示初始异步数据</h3><blockquote><p>有的时候, 我们服务端渲染的首屏网页也需要从其他异步接口来获取初始化数据. 此时就需要吧 html 返回给前端前先去访问异步接口. 那么怎么办咧…</p></blockquote><ul><li>首先, 给需要预先请求异步数据的组件加一个静态属性<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/e14c36ffa4822b5861b4020b886bf4cfebee913d">就是需要请求数据的方法</a></li><li>其次, 升级 server.js <a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/73bc58850ca9bc2407164e8bf3614f7282a8e5fa">就像这样</a></li></ul><p>最后…</p><p><img src="https://handle-note-img.niubishanshan.top/20240625231843.png" alt="20240625231843"></p><p><img src="https://handle-note-img.niubishanshan.top/gifs/ssr4-1.gif" alt="polyfill-error"></p><p>这里建议大家复习一下 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/47255455/babel-polyfill-vs-babel-plugins">polyfill 和 preset 的区别</a></p><p>反正我就这么<a target="_blank" rel="noopener" href="https://github.com/luoquanquan/react-ssr-show/commit/ff6c64c0172cc77bba17f036624ac1a0594a2262">干了一把</a></p><p>然后就…</p><p><img src="https://handle-note-img.niubishanshan.top/gifs/ssr5.gif" alt="polyfill-ok"></p><p>是不是可以痛快的玩耍啦 😺~</p><p><img src="https://handle-note-img.niubishanshan.top/20240625232053.png" alt="20240625232053"></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/blog/" rel="tag"># blog</a></div><div class="post-nav"><div class="post-nav-item"><a href="/blog/%E5%B0%8F%E5%93%A5%E5%93%A5-React-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/blog/%E5%B0%8F%E5%93%A5%E5%93%A5,%20React%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B/%E5%B0%8F%E5%93%A5%E5%93%A5,%20React%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BA%86%E8%A7%A3%E4%B8%8B-%E5%9F%BA%E7%A1%80%E7%AF%87/" rel="prev" title="小哥哥, React 服务端渲染要不要了解下-基础篇"><i class="fa fa-chevron-left"></i> 小哥哥, React 服务端渲染要不要了解下-基础篇</a></div><div class="post-nav-item"> <a href="/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E5%B7%A5%E5%85%B7/Mac%20%E5%88%87%E6%8D%A2%20zsh%20%E5%92%8C%20bash/" rel="next" title="Mac 切换 zsh 和 bash">Mac 切换 zsh 和 bash<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>
  window.addEventListener('tabs:register', function() {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%85%A5%E8%B7%AF%E7%94%B1%E7%95%85%E6%B8%B8%E7%9A%87%E5%86%A0%E8%B5%8C%E5%9C%BA"><span class="nav-text">加入路由畅游皇冠赌场</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93%E9%85%8D%E7%BD%AE-react-router"><span class="nav-text">客户端渲染配置 react-router</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E7%9A%84-react-router"><span class="nav-text">配置服务端渲染的 react-router</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D"><span class="nav-text">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-1"><span class="nav-text">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-redux-%E5%B8%A6%E4%B8%8A%E8%BA%AB%E4%BB%BD%E7%95%85%E7%8E%A9%E6%BE%B3%E9%97%A8%E7%9A%87%E5%86%A0"><span class="nav-text">配置 redux, 带上身份畅玩澳门皇冠</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%BC%95%E5%85%A5-redux"><span class="nav-text">客户端渲染引入 redux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ssr-%E5%BC%95%E5%85%A5-redux"><span class="nav-text">ssr 引入 redux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8-store-%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%BC%82%E6%AD%A5%E6%95%B0%E6%8D%AE"><span class="nav-text">在 store 中获取异步数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E9%A6%96%E5%B1%8F%E5%B1%95%E7%A4%BA%E5%88%9D%E5%A7%8B%E5%BC%82%E6%AD%A5%E6%95%B0%E6%8D%AE"><span class="nav-text">服务端渲染支持首屏展示初始异步数据</span></a></li></ol></li></ol></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="圈圈的圈" src="/images/avatar.png"><p class="site-author-name" itemprop="name">圈圈的圈</p><div class="site-description" itemprop="description">技术学习, 读书笔记, 生活感悟 ~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">142</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://juejin.im/user/5837c2bd61ff4b006ca8d1b2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5837c2bd61ff4b006ca8d1b2" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://github.com/luoquanquan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoquanquan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:luo_quanquan@163.com" title="E-Mail → mailto:luo_quanquan@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17034706号-1</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">圈圈的圈</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/js/theme-next-canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>